# æµ¸å…¥å¼å­¦è¯­è¨€åŠ©æ‰‹ - æ¶æ„ä¸åŠŸèƒ½è¯¦è§£

## ğŸ“‹ ç›®å½•

- [é¡¹ç›®æ¦‚è§ˆ](#é¡¹ç›®æ¦‚è§ˆ)
- [æ ¸å¿ƒåŠŸèƒ½æ¨¡å—](#æ ¸å¿ƒåŠŸèƒ½æ¨¡å—)
- [æŠ€æœ¯æ¶æ„](#æŠ€æœ¯æ¶æ„)
- [APIå‚è€ƒ](#apiå‚è€ƒ)
- [å¼€å‘æŒ‡å—](#å¼€å‘æŒ‡å—)
- [æ€§èƒ½ä¸ä¼˜åŒ–](#æ€§èƒ½ä¸ä¼˜åŒ–)
- [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)

---

## ğŸ“– é¡¹ç›®æ¦‚è§ˆ

### æ ¸å¿ƒç†å¿µ

æµ¸å…¥å¼å­¦è¯­è¨€åŠ©æ‰‹åŸºäºè‘—åçš„ **"i+1"** ç†è®ºï¼ˆå¯ç†è§£è¾“å…¥ç†è®ºï¼‰ï¼Œé€šè¿‡æ™ºèƒ½åœ°å°†ç½‘é¡µå†…å®¹ä¸­çš„éƒ¨åˆ†è¯æ±‡æ›¿æ¢ä¸ºç›®æ ‡è¯­è¨€ï¼Œåˆ›é€ ä¸€ä¸ªæ²‰æµ¸å¼çš„è¯­è¨€å­¦ä¹ ç¯å¢ƒã€‚ç”¨æˆ·åœ¨æ—¥å¸¸æµè§ˆç½‘é¡µçš„è¿‡ç¨‹ä¸­ï¼Œè‡ªç„¶åœ°æ¥è§¦å’Œå­¦ä¹ æ–°çš„è¯æ±‡ï¼Œå®ç°"æ¶¦ç‰©ç»†æ— å£°"çš„è¯­è¨€å­¦ä¹ ä½“éªŒã€‚

**ğŸ¯ é¡¹ç›®äº®ç‚¹**: é›†æˆäº†å®Œæ•´çš„å‘éŸ³å­¦ä¹ ç”Ÿæ€ç³»ç»Ÿå’Œæ™ºèƒ½å¤šè¯­è¨€ç¿»è¯‘åŠŸèƒ½ï¼ŒåŒ…æ‹¬è‡ªåŠ¨è¯­è¨€æ£€æµ‹ã€éŸ³æ ‡æ˜¾ç¤ºã€AIè¯ä¹‰è§£é‡Šã€åŒTTSè¯­éŸ³åˆæˆå’Œäº¤äº’å¼æ‚¬æµ®æ¡†ï¼Œä¸ºç”¨æˆ·æä¾›ä»æ™ºèƒ½ç¿»è¯‘åˆ°å‘éŸ³å­¦ä¹ çš„ä¸€ç«™å¼æ²‰æµ¸å¼ä½“éªŒã€‚

### æŠ€æœ¯æ ˆ

- **å‰ç«¯æ¡†æ¶**: Vue 3 + TypeScript
- **æ„å»ºå·¥å…·**: WXT (WebExtensionæ¡†æ¶)
- **å¼€å‘å·¥å…·**: Vite + ESLint + Prettier
- **APIé›†æˆ**: OpenAIå…¼å®¹æ¥å£ã€Dictionary APIã€æœ‰é“TTS
- **æ¶æ„æ¨¡å¼**: Provideræ¨¡å¼ + æ¨¡å—åŒ–è®¾è®¡ + äº‹ä»¶é©±åŠ¨
- **å‘éŸ³ç³»ç»Ÿ**: å·¥å‚æ¨¡å¼ + å¤šTTSæœåŠ¡ + æ™ºèƒ½ç¼“å­˜
- **å¤šè¯­è¨€æ”¯æŒ**: 20+ç§è¯­è¨€çš„æ™ºèƒ½æ£€æµ‹å’Œç¿»è¯‘ï¼ˆç†è®ºåŸºäºAIæ¨¡å‹èƒ½åŠ›ï¼‰
- **æµè§ˆå™¨æ”¯æŒ**: Chromeã€Edgeã€Firefoxã€Safariï¼ˆéƒ¨åˆ†æ”¯æŒï¼‰

### æ•´ä½“æ¶æ„

```
æµ¸å…¥å¼å­¦è¯­è¨€åŠ©æ‰‹
â”œâ”€â”€ ğŸ¯ æ ¸å¿ƒç¿»è¯‘å¼•æ“
â”‚   â”œâ”€â”€ æ™ºèƒ½è¯­è¨€æ£€æµ‹ç³»ç»Ÿï¼ˆAIè‡ªåŠ¨è¯†åˆ«æºè¯­è¨€ï¼‰
â”‚   â”œâ”€â”€ æ™ºèƒ½æ–‡æœ¬å¤„ç†ç³»ç»Ÿï¼ˆLLMåˆ†æé€‰è¯ï¼‰
â”‚   â”œâ”€â”€ AIç¿»è¯‘æœåŠ¡ï¼ˆ20+ç§è¯­è¨€æ”¯æŒï¼‰
â”‚   â””â”€â”€ ç¼“å­˜ä¸æ€§èƒ½ä¼˜åŒ–
â”œâ”€â”€ ğŸ”Š å‘éŸ³å­¦ä¹ ç”Ÿæ€ç³»ç»Ÿ â­
â”‚   â”œâ”€â”€ éŸ³æ ‡è·å–æœåŠ¡ï¼ˆDictionary APIï¼‰
â”‚   â”œâ”€â”€ å¤šTTSè¯­éŸ³åˆæˆï¼ˆæœ‰é“TTS + Web Speechï¼‰
â”‚   â”œâ”€â”€ AIè¯ä¹‰è§£é‡Šï¼ˆå®æ—¶ç”Ÿæˆä¸­æ–‡é‡Šä¹‰ï¼‰
â”‚   â”œâ”€â”€ äº¤äº’å¼æ‚¬æµ®æ¡†ï¼ˆåŒå±‚å­¦ä¹ ä½“éªŒï¼‰
â”‚   â””â”€â”€ æ™ºèƒ½ç¼“å­˜æœºåˆ¶ï¼ˆ24å°æ—¶TTLéŸ³æ ‡ç¼“å­˜ï¼‰
â”œâ”€â”€ ğŸ¨ ç”¨æˆ·ç•Œé¢å±‚
â”‚   â”œâ”€â”€ Vue 3 å¼¹çª—è®¾ç½®ç•Œé¢
â”‚   â”œâ”€â”€ 7ç§ç¿»è¯‘æ ·å¼ç®¡ç†ï¼ˆå«å­¦ä¹ æ¨¡å¼ï¼‰
â”‚   â”œâ”€â”€ ä¸»é¢˜é€‚é…ç³»ç»Ÿï¼ˆæ·±è‰²/æµ…è‰²ï¼‰
â”‚   â””â”€â”€ å“åº”å¼æ‚¬æµ®æç¤ºç³»ç»Ÿ
â””â”€â”€ ğŸ”§ åŸºç¡€è®¾æ–½å±‚
    â”œâ”€â”€ è·¨è®¾å¤‡é…ç½®åŒæ­¥ï¼ˆStorage Managerï¼‰
    â”œâ”€â”€ æ‰©å±•æ¶ˆæ¯ä¼ é€’ç³»ç»Ÿ
    â”œâ”€â”€ è·¨æµè§ˆå™¨å…¼å®¹å±‚
    â””â”€â”€ æ€§èƒ½ç›‘æ§ä¸ä¼˜åŒ–
```

---

## ğŸš€ æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### 1. æ™ºèƒ½æ–‡æœ¬å¤„ç†ç³»ç»Ÿ

**ä½ç½®**: `src/modules/textProcessor.ts`

**æ ¸å¿ƒèŒè´£**:
- DOMæ ‘éå†å’Œæ–‡æœ¬èŠ‚ç‚¹æå–
- æ™ºèƒ½æ®µè½åˆ†ç»„å’Œé•¿åº¦æ§åˆ¶
- æ–‡æœ¬æ›¿æ¢çš„ç²¾ç¡®å®šä½å’Œåº”ç”¨
- åŠ¨æ€å†…å®¹ç›‘å¬å’Œå¤„ç†

**å…³é”®ç‰¹æ€§**:
```typescript
// æ ¸å¿ƒå¤„ç†æµç¨‹
public async processRoot(
  root: Node,
  textReplacer: TextReplacer,
  originalWordDisplayMode: OriginalWordDisplayMode,
  maxLength: number = 400
): Promise<void>
```

- **æ™ºèƒ½åˆ†ç»„**: æŒ‰è¯­ä¹‰å•å…ƒç»„ç»‡æ–‡æœ¬ï¼Œå¹³è¡¡å¤„ç†æ•ˆç‡å’Œä¸Šä¸‹æ–‡å®Œæ•´æ€§
- **å¢é‡å¤„ç†**: åªå¤„ç†æ–°å¢å†…å®¹ï¼Œé¿å…é‡å¤ç¿»è¯‘
- **DOMå®‰å…¨**: ä½¿ç”¨Range APIç¡®ä¿DOMç»“æ„å®Œæ•´æ€§
- **æ€§èƒ½ä¼˜åŒ–**: é˜²æŠ–æœºåˆ¶é¿å…é¢‘ç¹é‡å¤å¤„ç†

**å¿½ç•¥ç­–ç•¥**:
- è·³è¿‡ä»£ç å—ã€è„šæœ¬ã€æ ·å¼ç­‰æŠ€æœ¯å†…å®¹
- é¿å…å¤„ç†å·²ç¿»è¯‘æˆ–æ ‡è®°çš„å†…å®¹
- æ™ºèƒ½è¯†åˆ«å¹¶ä¿æŠ¤éšè—æˆ–ä¸å¯è§å…ƒç´ 

### 2. AIç¿»è¯‘æœåŠ¡ï¼ˆé‡æ„åæ¨¡å—åŒ–æ¶æ„ï¼‰

**ä½ç½®**: `src/modules/api/` æ¨¡å—

**æ¶æ„è¯´æ˜**:
```
src/modules/api/
â”œâ”€â”€ index.ts                    # ç»Ÿä¸€å¯¼å‡ºå…¥å£
â”œâ”€â”€ types.ts                   # æ¥å£å’Œç±»å‹å®šä¹‰
â”œâ”€â”€ base/
â”‚   â””â”€â”€ BaseProvider.ts        # æŠ½è±¡åŸºç±»ï¼Œæä¾›å…¬å…±åŠŸèƒ½
â”œâ”€â”€ providers/
â”‚   â”œâ”€â”€ GoogleGeminiProvider.ts # Google Gemini APIå®ç°
â”‚   â”œâ”€â”€ OpenAIProvider.ts      # OpenAIå…¼å®¹APIå®ç°
â”‚   â””â”€â”€ index.ts               # Providerç»Ÿä¸€å¯¼å‡º
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ apiUtils.ts            # APIç›¸å…³å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ textUtils.ts           # æ–‡æœ¬å¤„ç†å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ requestUtils.ts        # è¯·æ±‚å¤„ç†å·¥å…·å‡½æ•°
â””â”€â”€ factory/
    â””â”€â”€ ApiServiceFactory.ts   # APIæœåŠ¡å·¥å‚
```

**æ ¸å¿ƒèŒè´£**:
- è°ƒç”¨å…¼å®¹OpenAI APIçš„å¤§è¯­è¨€æ¨¡å‹
- æ™ºèƒ½è¯æ±‡é€‰æ‹©å’Œéš¾åº¦é€‚é…  
- ç»“æ„åŒ–ç¿»è¯‘ç»“æœå¤„ç†
- é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶
- æ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºæ‰©å±•æ–°çš„ç¿»è¯‘æœåŠ¡

**APIæ¥å£è®¾è®¡**:
```typescript
interface FullTextAnalysisResponse {
  original: string;           // åŸå§‹æ–‡æœ¬
  processed: string;          // å¤„ç†åæ–‡æœ¬ï¼ˆå·²å¼ƒç”¨ï¼‰
  replacements: Replacement[]; // æ›¿æ¢é¡¹æ•°ç»„
}

interface Replacement {
  original: string;    // åŸæ–‡è¯æ±‡
  translation: string; // ç¿»è¯‘ç»“æœ
  position: {         // ä½ç½®ä¿¡æ¯
    start: number;
    end: number;
  };
  isNew: boolean;     // æ˜¯å¦ä¸ºç”Ÿè¯
  explanation?: string; // é¢å¤–è§£é‡Š
}
```

**æ™ºèƒ½ç¿»è¯‘ç­–ç•¥**:
- **æ™ºèƒ½è¯­è¨€æ£€æµ‹**: AIè‡ªåŠ¨è¯†åˆ«ç½‘é¡µæºè¯­è¨€ï¼Œæ— éœ€ç”¨æˆ·æ‰‹åŠ¨æŒ‡å®šè¯­è¨€ç±»å‹
- **éš¾åº¦é€‚é…**: æ ¹æ®ç”¨æˆ·è¯­è¨€æ°´å¹³è°ƒæ•´è¯æ±‡é€‰æ‹©
- **æ¯”ä¾‹æ§åˆ¶**: ç²¾ç¡®æ§åˆ¶ç¿»è¯‘è¯æ±‡å æ€»æ–‡æœ¬çš„æ¯”ä¾‹ï¼ˆ1%-100%å­—ç¬¦çº§ç²¾ç¡®è®¡ç®—ï¼‰
- **ä¸Šä¸‹æ–‡æ„ŸçŸ¥**: è€ƒè™‘è¯­å¢ƒé€‰æ‹©æœ€åˆé€‚çš„ç¿»è¯‘
- **å¤šè¯­è¨€æ”¯æŒ**: æ”¯æŒ20+ç§è¯­è¨€çš„æ™ºèƒ½ç¿»è¯‘ï¼ˆè‹±è¯­ã€æ—¥è¯­ã€éŸ©è¯­ã€æ³•è¯­ã€å¾·è¯­ã€è¥¿ç­ç‰™è¯­ã€ä¿„è¯­ã€æ„å¤§åˆ©è¯­ã€è‘¡è„ç‰™è¯­ã€è·å…°è¯­ã€ç‘å…¸è¯­ã€æŒªå¨è¯­ã€ä¸¹éº¦è¯­ã€èŠ¬å…°è¯­ã€æ³¢å…°è¯­ã€æ·å…‹è¯­ã€åœŸè€³å…¶è¯­ã€å¸Œè…Šè¯­ç­‰ï¼‰
- **æ™ºèƒ½å¤šè¯­è¨€æ¨¡å¼**: ç”¨æˆ·åªéœ€é€‰æ‹©ç›®æ ‡è¯­è¨€ï¼ŒAIè‡ªåŠ¨æ£€æµ‹æºè¯­è¨€å¹¶è¿›è¡Œç¿»è¯‘

### 3. å‘éŸ³ç”Ÿæ€ç³»ç»Ÿ

**ä½ç½®**: `src/modules/pronunciation/`

å‘éŸ³ç³»ç»Ÿæ˜¯é¡¹ç›®çš„ä¸€å¤§äº®ç‚¹ï¼Œé‡‡ç”¨æ¨¡å—åŒ–æ¶æ„è®¾è®¡ï¼Œæ”¯æŒå¤šç§éŸ³æ ‡å’Œè¯­éŸ³åˆæˆæœåŠ¡ã€‚

#### 3.1 éŸ³æ ‡æœåŠ¡æ¶æ„

```
pronunciation/
â”œâ”€â”€ phonetic/              # éŸ³æ ‡è·å–æ¨¡å—
â”‚   â”œâ”€â”€ IPhoneticProvider.ts       # éŸ³æ ‡æœåŠ¡æ¥å£
â”‚   â”œâ”€â”€ DictionaryApiProvider.ts   # Dictionary APIå®ç°
â”‚   â””â”€â”€ PhoneticProviderFactory.ts # éŸ³æ ‡æœåŠ¡å·¥å‚
â”œâ”€â”€ tts/                   # è¯­éŸ³åˆæˆæ¨¡å—
â”‚   â”œâ”€â”€ ITTSProvider.ts            # TTSæœåŠ¡æ¥å£
â”‚   â”œâ”€â”€ WebSpeechTTSProvider.ts    # Web Speech APIå®ç°
â”‚   â”œâ”€â”€ YoudaoTTSProvider.ts       # æœ‰é“TTSå®ç°
â”‚   â””â”€â”€ TTSProviderFactory.ts      # TTSæœåŠ¡å·¥å‚
â”œâ”€â”€ translation/           # AIç¿»è¯‘æ¨¡å—
â”‚   â””â”€â”€ AITranslationProvider.ts   # AIè¯ä¹‰è·å–
â”œâ”€â”€ services/              # æ ¸å¿ƒæœåŠ¡å±‚
â”‚   â”œâ”€â”€ PronunciationService.ts    # å‘éŸ³æœåŠ¡åè°ƒå™¨
â”‚   â””â”€â”€ TTSService.ts              # TTSæœåŠ¡ç®¡ç†å™¨
â”œâ”€â”€ ui/                    # ç”¨æˆ·ç•Œé¢ç»„ä»¶
â”‚   â”œâ”€â”€ TooltipRenderer.ts         # æ‚¬æµ®æ¡†æ¸²æŸ“å™¨
â”‚   â””â”€â”€ EventManager.ts            # äº‹ä»¶ç®¡ç†å™¨
â””â”€â”€ utils/                 # å·¥å…·å‡½æ•°
    â”œâ”€â”€ DOMUtils.ts               # DOMæ“ä½œå·¥å…·
    â”œâ”€â”€ PositionUtils.ts          # ä½ç½®è®¡ç®—å·¥å…·
    â””â”€â”€ TimerManager.ts           # å®šæ—¶å™¨ç®¡ç†
```

#### 3.2 PronunciationServiceæ ¸å¿ƒåŠŸèƒ½

**ä¸»è¦èŒè´£**:
- åè°ƒéŸ³æ ‡è·å–ã€AIç¿»è¯‘å’Œè¯­éŸ³åˆæˆ
- ç®¡ç†æ‚¬æµ®æ¡†çš„æ˜¾ç¤ºå’Œéšè—é€»è¾‘
- æä¾›åŒå±‚äº¤äº’ä½“éªŒï¼ˆçŸ­è¯­â†’å•è¯ï¼‰
- å®ç°æ™ºèƒ½ç¼“å­˜å’Œæ€§èƒ½ä¼˜åŒ–

**æ ¸å¿ƒæ–¹æ³•**:
```typescript
// ä¸ºç¿»è¯‘å…ƒç´ æ·»åŠ å‘éŸ³åŠŸèƒ½
async addPronunciationToElement(
  element: HTMLElement,
  word: string,
  isPhrase?: boolean
): Promise<boolean>

// è¯­éŸ³åˆæˆï¼ˆæ”¯æŒä¸»å¤‡åŒTTSï¼‰
async speakText(text: string): Promise<TTSResult>

// è·å–éŸ³æ ‡ä¿¡æ¯
async getPhonetic(word: string): Promise<PhoneticResult>
```

#### 3.3 äº¤äº’å¼æ‚¬æµ®æ¡†ç³»ç»Ÿ

**æ‚¬æµ®æ¡†ç±»å‹**:
1. **å•è¯æ‚¬æµ®æ¡†**: æ˜¾ç¤ºéŸ³æ ‡ã€AIè¯ä¹‰ã€æœ—è¯»æŒ‰é’®
2. **çŸ­è¯­æ‚¬æµ®æ¡†**: æ˜¾ç¤ºå¯äº¤äº’çš„å•è¯åˆ—è¡¨
3. **åµŒå¥—æ‚¬æµ®æ¡†**: çŸ­è¯­ä¸­å•ä¸ªå•è¯çš„è¯¦ç»†ä¿¡æ¯

**æ™ºèƒ½æ˜¾ç¤ºé€»è¾‘**:
- æ¸è¿›å¼åŠ è½½ï¼šå…ˆæ˜¾ç¤ºåŸºç¡€ä¿¡æ¯ï¼Œå†å¼‚æ­¥åŠ è½½è¯¦ç»†å†…å®¹
- æ™ºèƒ½å®šä½ï¼šè‡ªåŠ¨è®¡ç®—æœ€ä½³æ˜¾ç¤ºä½ç½®ï¼Œé¿å…è¾¹ç•Œæº¢å‡º
- äº¤äº’ä¼˜åŒ–ï¼šæ”¯æŒé¼ æ ‡æ‚¬åœå»¶è¿Ÿã€ç‚¹å‡»å›ºå®šç­‰äº¤äº’æ¨¡å¼

### 4. æ ·å¼ç®¡ç†ç³»ç»Ÿ

**ä½ç½®**: `src/modules/styleManager.ts`

**æ ¸å¿ƒåŠŸèƒ½**:
- åŠ¨æ€CSSæ³¨å…¥å’Œç®¡ç†
- å¤šç§ç¿»è¯‘æ˜¾ç¤ºæ ·å¼æ”¯æŒ
- ä¸»é¢˜é€‚é…å’Œå“åº”å¼è®¾è®¡
- åŠ¨ç”»æ•ˆæœå’Œäº¤äº’åé¦ˆ

**æ”¯æŒçš„æ ·å¼ç±»å‹**:
```typescript
enum TranslationStyle {
  DEFAULT = 'default',      // é»˜è®¤è“è‰²æ ·å¼
  SUBTLE = 'subtle',        // å¾®å¦™ç°è‰²æ ·å¼
  BOLD = 'bold',           // ç²—ä½“æ ·å¼
  ITALIC = 'italic',       // æ–œä½“æ ·å¼
  UNDERLINED = 'underlined', // ä¸‹åˆ’çº¿æ ·å¼
  HIGHLIGHTED = 'highlighted', // é«˜äº®æ ·å¼
  LEARNING = 'learning'     // å­¦ä¹ æ¨¡å¼ï¼ˆæ¨¡ç³Šæ•ˆæœï¼‰
}
```

**é«˜çº§æ ·å¼ç‰¹æ€§**:
- **è¾‰å…‰åŠ¨ç”»**: æ–°ç¿»è¯‘è¯æ±‡å‡ºç°æ—¶çš„æŸ”å’Œæç¤ºæ•ˆæœï¼Œä¸å¹²æ‰°é˜…è¯»ä½“éªŒ
- **å­¦ä¹ æ¨¡å¼**: ç¿»è¯‘è¯æ±‡åˆå§‹æ¨¡ç³Šæ˜¾ç¤ºï¼Œé¼ æ ‡æ‚¬åœæ—¶æ¸…æ™°åŒ–ï¼Œå¢å¼ºè®°å¿†æ•ˆæœ
- **å“åº”å¼è®¾è®¡**: è‡ªé€‚åº”æ·±è‰²/æµ…è‰²ä¸»é¢˜ï¼Œæ™ºèƒ½æ‚¬æµ®æ¡†å®šä½
- **æ— éšœç¢æ”¯æŒ**: è€ƒè™‘è‰²å½©å¯¹æ¯”åº¦å’Œå¯è¯»æ€§



### 5. é…ç½®ä¸å­˜å‚¨ç®¡ç†

**ä½ç½®**: `src/modules/storageManager.ts`, `src/modules/types.ts`

**æ•°æ®æ¨¡å‹**:
```typescript
interface UserSettings {
  userLevel: UserLevel;                    // ç”¨æˆ·è¯­è¨€æ°´å¹³ï¼ˆ5ä¸ªçº§åˆ«ï¼‰
  replacementRate: number;                 // ç¿»è¯‘æ¯”ä¾‹ï¼ˆ1%-100%ï¼‰
  isEnabled: boolean;                      // åŠŸèƒ½å¼€å…³
  useGptApi: boolean;                      // ä½¿ç”¨AIç¿»è¯‘
  apiConfig: ApiConfig;                    // APIé…ç½®
  translationStyle: TranslationStyle;      // ç¿»è¯‘æ ·å¼ï¼ˆ7ç§æ ·å¼ï¼‰
  triggerMode: TriggerMode;                // è§¦å‘æ¨¡å¼ï¼ˆè‡ªåŠ¨/æ‰‹åŠ¨ï¼‰
  maxLength: number;                       // æ®µè½æœ€å¤§é•¿åº¦
  translationDirection: string;            // ç¿»è¯‘æ–¹å‘/æ™ºèƒ½å¤šè¯­è¨€æ¨¡å¼
  originalWordDisplayMode: OriginalWordDisplayMode; // åŸæ–‡æ˜¾ç¤ºæ¨¡å¼
  enablePronunciationTooltip: boolean;     // å‘éŸ³æ‚¬æµ®æ¡†å¼€å…³
}

interface ApiConfig {
  apiKey: string;                          // APIå¯†é’¥
  apiEndpoint: string;                     // APIç«¯ç‚¹
  model: string;                           // æ¨¡å‹åç§°
  temperature: number;                     // æ¸©åº¦å‚æ•°ï¼ˆé»˜è®¤0.2ï¼‰
}
```

**å­˜å‚¨ç­–ç•¥**:
- ä½¿ç”¨ `browser.storage.sync` å®ç°è·¨è®¾å¤‡åŒæ­¥
- å‘åå…¼å®¹çš„é…ç½®è¿ç§»æœºåˆ¶
- é»˜è®¤å€¼ä¿æŠ¤å’Œé”™è¯¯æ¢å¤
- å®æ—¶é…ç½®æ›´æ–°å’Œæ¶ˆæ¯ä¼ é€’

---

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### æ¨¡å—åŒ–è®¾è®¡åŸåˆ™

é¡¹ç›®é‡‡ç”¨é«˜åº¦æ¨¡å—åŒ–çš„æ¶æ„ï¼Œæ¯ä¸ªæ¨¡å—éƒ½æœ‰æ˜ç¡®çš„èŒè´£è¾¹ç•Œå’Œæ ‡å‡†åŒ–çš„æ¥å£ã€‚

#### 1. åˆ†å±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ç”¨æˆ·ç•Œé¢å±‚ (UI Layer)         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Popup UI  â”‚ â”‚ Content Styles  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          æœåŠ¡å±‚ (Service Layer)        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚Pronunciationâ”‚ â”‚  Text Processor â”‚ â”‚
â”‚  â”‚   Service   â”‚ â”‚                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         æä¾›è€…å±‚ (Provider Layer)      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ API Service â”‚ â”‚   TTS/Phonetic  â”‚ â”‚
â”‚  â”‚             â”‚ â”‚    Providers    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         åŸºç¡€è®¾æ–½å±‚ (Infrastructure)    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Storage   â”‚ â”‚    Messaging    â”‚ â”‚
â”‚  â”‚   Manager   â”‚ â”‚     System      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2. Provideræ¨¡å¼å®ç°

æ‰€æœ‰å¤–éƒ¨æœåŠ¡éƒ½é€šè¿‡Provideræ¨¡å¼æŠ½è±¡ï¼š

```typescript
// ç»Ÿä¸€çš„Provideræ¥å£
interface IPhoneticProvider {
  getName(): string;
  getPhonetic(word: string): Promise<PhoneticResult>;
}

// å·¥å‚æ¨¡å¼åˆ›å»ºProviderå®ä¾‹
class PhoneticProviderFactory {
  static createProvider(providerName: string): IPhoneticProvider {
    switch (providerName) {
      case 'dictionary-api':
        return new DictionaryApiProvider();
      default:
        throw new Error(`Unknown provider: ${providerName}`);
    }
  }
}
```

#### 3. äº‹ä»¶é©±åŠ¨æ¶æ„

ç³»ç»Ÿé‡‡ç”¨äº‹ä»¶é©±åŠ¨çš„æ¶ˆæ¯ä¼ é€’æœºåˆ¶ï¼š

```typescript
// æ¶ˆæ¯ç±»å‹å®šä¹‰
interface MessageTypes {
  'settings_updated': { settings: UserSettings };
  'MANUAL_TRANSLATE': {};
  'validate-configuration': { source: string };
}

// ç»Ÿä¸€çš„æ¶ˆæ¯å¤„ç†
browser.runtime.onMessage.addListener((message, sender, sendResponse) => {
  switch (message.type) {
    case 'settings_updated':
      handleSettingsUpdate(message.settings);
      break;
    // ... å…¶ä»–æ¶ˆæ¯å¤„ç†
  }
});
```

### æ•°æ®æµè®¾è®¡

#### 1. ç¿»è¯‘å¤„ç†æµç¨‹

```
ç”¨æˆ·è®¿é—®ç½‘é¡µ
    â†“
DOMå†…å®¹è§£æå’Œæ–‡æœ¬æå–
    â†“
æ–‡æœ¬åˆ†ç»„å’Œé•¿åº¦æ§åˆ¶
    â†“
AI APIè°ƒç”¨å’Œç¿»è¯‘è·å–
    â†“
æ›¿æ¢ç»“æœå®šä½å’Œåº”ç”¨
    â†“
æ ·å¼åº”ç”¨å’ŒåŠ¨ç”»æ•ˆæœ
    â†“
å‘éŸ³åŠŸèƒ½æ³¨å†Œï¼ˆå¯é€‰ï¼‰
```

#### 2. å‘éŸ³æœåŠ¡æµç¨‹

```
ç”¨æˆ·é¼ æ ‡æ‚¬åœç¿»è¯‘è¯æ±‡
    â†“
è§¦å‘å‘éŸ³æœåŠ¡æ³¨å†Œ
    â†“
å¹¶è¡Œå¼‚æ­¥åŠ è½½ï¼š
â”œâ”€ éŸ³æ ‡è·å– (Dictionary API)
â”œâ”€ AIè¯ä¹‰è·å– (OpenAI API)
â””â”€ TTSæœåŠ¡å‡†å¤‡ (æœ‰é“/Web Speech)
    â†“
æ¸²æŸ“æ‚¬æµ®æ¡†ç•Œé¢
    â†“
ç”¨æˆ·äº¤äº’ï¼šæ’­æ”¾è¯­éŸ³ã€æŸ¥çœ‹è¯ä¹‰
```

### æ‰©å±•æ€§æœºåˆ¶

#### 1. æ’ä»¶å¼Provider

æ–°çš„APIæœåŠ¡å¯ä»¥é€šè¿‡å®ç°æ ‡å‡†æ¥å£è½»æ¾é›†æˆï¼š

```typescript
// æ–°å¢ç¿»è¯‘æœåŠ¡
class NewTranslationProvider implements ITranslationProvider {
  async translate(text: string, options: TranslationOptions): Promise<TranslationResult> {
    // å®ç°å…·ä½“ç¿»è¯‘é€»è¾‘
  }
}

// åœ¨å·¥å‚ä¸­æ³¨å†Œ
TranslationProviderFactory.register('new-service', NewTranslationProvider);
```

#### 2. ä¸»é¢˜å’Œæ ·å¼æ‰©å±•

æ ·å¼ç³»ç»Ÿæ”¯æŒè‡ªå®šä¹‰ä¸»é¢˜ï¼š

```typescript
// æ–°å¢ç¿»è¯‘æ ·å¼
enum CustomTranslationStyle {
  NEON = 'neon',
  GRADIENT = 'gradient'
}

// åœ¨æ ·å¼ç®¡ç†å™¨ä¸­æ³¨å†Œ
styleManager.registerStyle('neon', {
  color: '#00ff00',
  textShadow: '0 0 10px #00ff00'
});
```

---

## ğŸ“– ä½¿ç”¨æŒ‡å—å’Œæµ‹è¯•æ–‡æ¡£

**è¯¦ç»†çš„APIä½¿ç”¨æ–¹æ³•ã€æµ‹è¯•æŒ‡å—ã€è°ƒè¯•æŠ€å·§å’Œæ•…éšœæ’é™¤ï¼Œè¯·å‚è€ƒï¼š**

ğŸ“š **[TEST_DOC.md](./TEST_DOC.md)** - å®Œæ•´çš„ä½¿ç”¨æŒ‡å—ä¸æµ‹è¯•æ–‡æ¡£

è¯¥æ–‡æ¡£åŒ…å«ï¼š
- âœ… **UniversalApiService é€šç”¨AIæœåŠ¡** - æ–°å¢çš„é€šç”¨å¤§æ¨¡å‹è°ƒç”¨èƒ½åŠ›
- âœ… **APIå‚è€ƒä¸ä½¿ç”¨ç¤ºä¾‹** - ç¿»è¯‘æœåŠ¡ã€å‘éŸ³æœåŠ¡ã€è®¾ç½®ç®¡ç†ç­‰å®Œæ•´API
- âœ… **æµ‹è¯•æŒ‡å—** - è‡ªåŠ¨åŒ–æµ‹è¯•å’Œæ‰‹åŠ¨æµ‹è¯•æ£€æŸ¥æ¸…å•
- âœ… **è°ƒè¯•æŠ€å·§** - æ€§èƒ½ç›‘æ§ã€é”™è¯¯è¯Šæ–­ã€ç½‘ç»œè°ƒè¯•ç­‰
- âœ… **æ•…éšœæ’é™¤** - å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆå’Œé”™è¯¯ä»£ç å‚è€ƒ
- âœ… **æ€§èƒ½ä¼˜åŒ–å»ºè®®** - ç¼“å­˜ç­–ç•¥ã€å†…å­˜ç®¡ç†ã€æ‰¹é‡å¤„ç†ç­‰
```

#### è¯·æ±‚å¤„ç†å·¥å…·å‡½æ•°
```typescript
import { sendApiRequest } from '@/src/modules/api';

// å‘é€APIè¯·æ±‚ï¼ˆæ”¯æŒåå°ä»£ç†ï¼‰
const response = await sendApiRequest(
  requestBody,    // è¯·æ±‚ä½“
  apiConfig,      // APIé…ç½®
  0              // è¶…æ—¶æ—¶é—´ï¼ˆ0è¡¨ç¤ºæ— é™åˆ¶ï¼‰
);
```

### æ–‡æœ¬å¤„ç†API

#### å¤„ç†é¡µé¢å†…å®¹
```typescript
import { TextProcessor } from '@/src/modules/textProcessor';
import { TextReplacer } from '@/src/modules/textReplacer';
import { OriginalWordDisplayMode } from '@/src/modules/types';

const textProcessor = new TextProcessor(true); // å¯ç”¨å‘éŸ³åŠŸèƒ½
const textReplacer = new TextReplacer(config);

await textProcessor.processRoot(
  document.body,                           // æ ¹èŠ‚ç‚¹
  textReplacer,                           // æ–‡æœ¬æ›¿æ¢å™¨
  OriginalWordDisplayMode.VISIBLE,        // åŸæ–‡æ˜¾ç¤ºæ¨¡å¼
  400                                     // æœ€å¤§æ®µè½é•¿åº¦
);
```

#### æ›¿æ¢æ–‡æœ¬
```typescript
import { ReplacementConfig } from '@/src/modules/types';

const config: ReplacementConfig = {
  userLevel: UserLevel.INTERMEDIATE,
  replacementRate: 0.3,
  useGptApi: true,
  translationStyle: TranslationStyle.DEFAULT,
  translationDirection: 'intelligent'
};

const textReplacer = new TextReplacer(config);
const result = await textReplacer.replaceText("è¿™æ˜¯ä¸€æ®µä¸­æ–‡æ–‡æœ¬");

console.log(result.replacements); // æ›¿æ¢é¡¹æ•°ç»„
```

### æ ·å¼ç®¡ç†API

#### è®¾ç½®ç¿»è¯‘æ ·å¼
```typescript
const styleManager = new StyleManager();
styleManager.setTranslationStyle(TranslationStyle.HIGHLIGHTED);
```

#### è·å–å½“å‰æ ·å¼ç±»å
```typescript
const className = styleManager.getCurrentStyleClass();
// è¿”å›: "wxt-style-highlighted"
```

---

## ğŸ’» å¼€å‘æŒ‡å—

### ç¯å¢ƒé…ç½®

#### 1. ç³»ç»Ÿè¦æ±‚
- Node.js 18+ 
- npm æˆ– pnpm
- æ”¯æŒWebExtensionçš„æµè§ˆå™¨

#### 2. å®‰è£…ä¾èµ–
```bash
git clone https://github.com/xiao-zaiyi/illa-helper.git
cd illa-helper
npm install
```

#### 3. ç¯å¢ƒå˜é‡é…ç½®
```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
cp .env.example .env

# ç¼–è¾‘é…ç½®æ–‡ä»¶
# è‡³å°‘éœ€è¦é…ç½®APIå¯†é’¥
    VITE_WXT_DEFAULT_API_KEY="sk-your-api-key"
    VITE_WXT_DEFAULT_API_ENDPOINT="https://api.openai.com/v1/chat/completions"
    VITE_WXT_DEFAULT_MODEL="gpt-4"
    VITE_WXT_DEFAULT_TEMPERATURE="0.2"
```

#### 4. å¼€å‘è¿è¡Œ
```bash
# å¼€å‘æ¨¡å¼ï¼ˆChromeï¼‰
npm run dev

# å¼€å‘æ¨¡å¼ï¼ˆFirefoxï¼‰
npm run dev:firefox

# ç”Ÿäº§æ„å»º
npm run build

# æ‰“åŒ…æ‰©å±•
npm run zip
```

### ä»£ç ç»“æ„è§„èŒƒ

#### 1. ç›®å½•ç»„ç»‡
```
src/modules/
â”œâ”€â”€ [åŠŸèƒ½æ¨¡å—]/
â”‚   â”œâ”€â”€ index.ts          # æ¨¡å—ä¸»å…¥å£
â”‚   â”œâ”€â”€ types.ts          # ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ config.ts         # é…ç½®å¸¸é‡
â”‚   â”œâ”€â”€ services/         # æœåŠ¡å±‚
â”‚   â”œâ”€â”€ providers/        # æä¾›è€…å®ç°
â”‚   â””â”€â”€ utils/           # å·¥å…·å‡½æ•°
```

#### 2. å‘½åè§„èŒƒ
- **æ–‡ä»¶å**: ä½¿ç”¨PascalCaseï¼ˆå¦‚ `TextProcessor.ts`ï¼‰
- **ç±»å**: PascalCaseï¼ˆå¦‚ `class TextProcessor`ï¼‰
- **æ¥å£å**: ä»¥ `I` å¼€å¤´ï¼ˆå¦‚ `interface IPhoneticProvider`ï¼‰
- **æ–¹æ³•å**: camelCaseï¼ˆå¦‚ `processText()`ï¼‰
- **å¸¸é‡**: UPPER_SNAKE_CASEï¼ˆå¦‚ `DEFAULT_CONFIG`ï¼‰

#### 3. TypeScriptè§„èŒƒ
```typescript
// ä½¿ç”¨ä¸¥æ ¼çš„ç±»å‹å®šä¹‰
interface StrictInterface {
  required: string;
  optional?: number;
}

// é¿å…ä½¿ç”¨ anyï¼Œä½¿ç”¨æ³›å‹
function processData<T>(data: T): Promise<T> {
  return Promise.resolve(data);
}

// ä½¿ç”¨è”åˆç±»å‹è€Œéå­—ç¬¦ä¸²
type Theme = 'light' | 'dark' | 'auto';
```

### æ–°åŠŸèƒ½å¼€å‘æµç¨‹

#### 1. æ·»åŠ æ–°çš„ç¿»è¯‘Providerï¼ˆæ–°æ¶æ„ï¼‰
```typescript
// 1. åœ¨ src/modules/api/providers/ ç›®å½•ä¸‹åˆ›å»ºæ–°æ–‡ä»¶
// ä¾‹å¦‚ï¼šClaudeProvider.ts

import { BaseProvider } from '../base/BaseProvider';
import { UserSettings, FullTextAnalysisResponse } from '../../types';

export class ClaudeProvider extends BaseProvider {
  protected getProviderName(): string {
    return 'Claude';
  }

  protected async doAnalyzeFullText(
    text: string,
    settings: UserSettings,
  ): Promise<FullTextAnalysisResponse> {
    // å®ç°Claude APIè°ƒç”¨é€»è¾‘
    const response = await this.callClaudeAPI(text, settings);
    return this.parseClaudeResponse(response, text);
  }

  private async callClaudeAPI(text: string, settings: UserSettings) {
    // Claude APIè°ƒç”¨å®ç°
    const config = this.getConfig();
    // ... å…·ä½“å®ç°
  }

  private parseClaudeResponse(response: any, originalText: string): FullTextAnalysisResponse {
    // è§£æClaudeå“åº”æ ¼å¼
    // ... å…·ä½“å®ç°
  }
}

// 2. åœ¨ providers/index.ts ä¸­å¯¼å‡º
export { ClaudeProvider } from './ClaudeProvider';

// 3. åœ¨ ApiServiceFactory.ts ä¸­æ·»åŠ åˆ›å»ºé€»è¾‘
import { ClaudeProvider } from '../providers';

export class ApiServiceFactory {
  static createProvider(activeConfig: ApiConfigItem): ITranslationProvider {
    const { provider, config } = activeConfig;

    switch (provider) {
      case TranslationProvider.Claude:  // æ·»åŠ æ–°çš„æšä¸¾å€¼
        return new ClaudeProvider(config);
      // ... å…¶ä»–Provider
    }
  }
}

// 4. åœ¨ types.ts ä¸­æ·»åŠ æ–°çš„Providerç±»å‹
enum TranslationProvider {
  // ... ç°æœ‰ç±»å‹
  Claude = 'claude'
}
```

#### 2. æ·»åŠ æ–°çš„æ ·å¼
```typescript
// 1. æ‰©å±•æ ·å¼æšä¸¾
enum TranslationStyle {
  // ... ç°æœ‰æ ·å¼
  NEW_STYLE = 'new-style'
}

// 2. åœ¨æ ·å¼ç®¡ç†å™¨ä¸­æ·»åŠ CSS
private initializeStyles(): void {
  const styleElement = document.createElement('style');
  styleElement.textContent = `
    /* ... ç°æœ‰æ ·å¼ */
    .wxt-style-new-style {
      /* æ–°æ ·å¼å®šä¹‰ */
    }
  `;
}
```

#### 3. æ·»åŠ æ–°çš„é…ç½®é€‰é¡¹
```typescript
// 1. æ‰©å±•ç”¨æˆ·è®¾ç½®æ¥å£
interface UserSettings {
  // ... ç°æœ‰è®¾ç½®
  newOption: boolean;
}

// 2. æ›´æ–°é»˜è®¤è®¾ç½®
const DEFAULT_SETTINGS: UserSettings = {
  // ... ç°æœ‰é»˜è®¤å€¼
  newOption: false
};

// 3. åœ¨UIä¸­æ·»åŠ æ§åˆ¶ç»„ä»¶
<div class="setting-group">
  <label>æ–°åŠŸèƒ½é€‰é¡¹</label>
  <input type="checkbox" v-model="settings.newOption" />
</div>
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒä¸è´¡çŒ®

### è´¡çŒ®æŒ‡å—

æˆ‘ä»¬æ¬¢è¿å„ç§å½¢å¼çš„è´¡çŒ®ï¼è¯·æŸ¥çœ‹ä¸»é¡¹ç›®çš„ [README.md](../README.md) äº†è§£å¦‚ä½•å‚ä¸è´¡çŒ®ã€‚

### æŠ€æœ¯è®¨è®º

- **GitHub Issues**: æŠ¥å‘Šé”™è¯¯å’ŒåŠŸèƒ½è¯·æ±‚
- **Pull Requests**: ä»£ç è´¡çŒ®å’Œæ”¹è¿›
- **Discussions**: æŠ€æœ¯è®¨è®ºå’Œç»éªŒåˆ†äº«

### å¼€å‘è·¯çº¿å›¾

#### å·²å®Œæˆç‰¹æ€§ âœ…
- [x] æ™ºèƒ½è¯­è¨€æ£€æµ‹ï¼ˆAIè‡ªåŠ¨è¯†åˆ«æºè¯­è¨€ï¼‰
- [x] æ™ºèƒ½å¤šè¯­è¨€æ¨¡å¼ï¼ˆ20+ç§è¯­è¨€æ”¯æŒï¼‰
- [x] å®Œæ•´å‘éŸ³å­¦ä¹ ç”Ÿæ€ç³»ç»Ÿï¼ˆéŸ³æ ‡+AIè¯ä¹‰+åŒTTSï¼‰
- [x] äº¤äº’å¼æ‚¬æµ®æ¡†ç³»ç»Ÿï¼ˆåŒå±‚å­¦ä¹ ä½“éªŒï¼‰
- [x] 7ç§ç¿»è¯‘æ ·å¼ï¼ˆå«å­¦ä¹ æ¨¡å¼ï¼‰
- [x] ä¸»é¢˜é€‚é…ç³»ç»Ÿï¼ˆæ·±è‰²/æµ…è‰²ï¼‰
- [x] æ™ºèƒ½ç¼“å­˜æœºåˆ¶ï¼ˆå¤šçº§ç¼“å­˜ä¼˜åŒ–ï¼‰
- [x] **APIæ¨¡å—é‡æ„**ï¼ˆæ¨¡å—åŒ–æ¶æ„ï¼Œæ˜“äºæ‰©å±•ï¼‰

#### è§„åˆ’ä¸­ç‰¹æ€§ ğŸš€
- [ ] å¢åŠ å•è¯æ”¶è—å’Œå¤ä¹ åŠŸèƒ½
- [ ] å®ç°å­¦ä¹ è¿›åº¦è¿½è¸ª
- [ ] æ”¯æŒè‡ªå®šä¹‰è¯åº“å¯¼å…¥
- [ ] å¢åŠ è¯­æ³•åˆ†æå’Œå¥å‹å­¦ä¹ 
- [ ] å¼€å‘ç§»åŠ¨ç«¯ä¼´ä¾£åº”ç”¨
- [ ] æ”¯æŒæ›´å¤šTTSæœåŠ¡ï¼ˆAzureã€Googleç­‰ï¼‰

---

## ğŸ“‹ APIè¿ç§»æŒ‡å—

### ä»æ—§APIè¿ç§»åˆ°æ–°API

å¦‚æœæ‚¨ä¹‹å‰ä½¿ç”¨æ—§çš„APIï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œè¿ç§»ï¼š

#### 1. å¯¼å…¥è¯­å¥æ›´æ–°

```typescript
// æ—§ç‰ˆæœ¬ (å·²åºŸå¼ƒ)
import { ApiService } from '@/src/modules/apiService';

// æ–°ç‰ˆæœ¬ (æ¨è)
import { ApiServiceFactory } from '@/src/modules/api';
```

#### 2. åˆ›å»ºProviderå®ä¾‹

```typescript
// æ—§ç‰ˆæœ¬
const provider = ApiService.createProvider(activeConfig);

// æ–°ç‰ˆæœ¬ (æ–¹æ³•åç›¸åŒï¼Œä½†ä½¿ç”¨æ–°çš„å·¥å‚ç±»)
const provider = ApiServiceFactory.createProvider(activeConfig);
```

#### 3. å¯¼å…¥å·¥å…·å‡½æ•°

```typescript
// æ—§ç‰ˆæœ¬ (ç›´æ¥ä»apiServiceå¯¼å…¥)
import { mergeCustomParams } from '@/src/modules/apiService';

// æ–°ç‰ˆæœ¬ (ä»apiæ¨¡å—å¯¼å…¥)
import { mergeCustomParams } from '@/src/modules/api';
```

#### 4. æ‰©å±•æ–°Provider

```typescript
// æ—§ç‰ˆæœ¬ (éœ€è¦ä¿®æ”¹apiService.tsæ–‡ä»¶)
// åœ¨å•ä¸ªæ–‡ä»¶ä¸­æ·»åŠ æ–°çš„Providerç±»...

// æ–°ç‰ˆæœ¬ (åˆ›å»ºç‹¬ç«‹æ–‡ä»¶)
// 1. åœ¨ src/modules/api/providers/ ä¸‹åˆ›å»ºæ–°æ–‡ä»¶
// 2. ç»§æ‰¿ BaseProvider
// 3. åœ¨å·¥å‚ä¸­æ³¨å†Œ
```

### è¿ç§»æ£€æŸ¥æ¸…å•

- [ ] æ›´æ–°æ‰€æœ‰å¯¼å…¥è¯­å¥ä» `./apiService` åˆ° `./api`
- [ ] å°† `ApiService` æ›¿æ¢ä¸º `ApiServiceFactory`
- [ ] æ£€æŸ¥è‡ªå®šä¹‰Provideræ˜¯å¦éœ€è¦é‡æ„ä¸ºæ–°çš„æ¶æ„
- [ ] éªŒè¯æ‰€æœ‰APIè°ƒç”¨æ­£å¸¸å·¥ä½œ
- [ ] æ›´æ–°ç›¸å…³æµ‹è¯•ä»£ç 

### è¿ç§»ä¼˜åŠ¿

- âœ… **æ¨¡å—åŒ–è®¾è®¡**: æ›´æ¸…æ™°çš„ä»£ç ç»„ç»‡
- âœ… **æ˜“äºæ‰©å±•**: æ·»åŠ æ–°Provideræ›´ç®€å•  
- âœ… **æ›´å¥½çš„æµ‹è¯•**: å„æ¨¡å—å¯ç‹¬ç«‹æµ‹è¯•
- âœ… **ç±»å‹å®‰å…¨**: æ›´ä¸¥æ ¼çš„TypeScriptç±»å‹æ£€æŸ¥
- âœ… **ä»£ç å¤ç”¨**: å…¬å…±åŠŸèƒ½é€šè¿‡BaseProviderå…±äº«

---

### 
```mermaid
graph TB
    subgraph "é‡æ„å‰ - å•æ–‡ä»¶æ¶æ„"
        A1[apiService.ts<br/>385è¡Œä»£ç ]
        A1 --> A2[ğŸ”´ æ¥å£å®šä¹‰]
        A1 --> A3[ğŸ”´ å·¥å…·å‡½æ•°]
        A1 --> A4[ğŸ”´ GoogleGeminiProviderç±»]
        A1 --> A5[ğŸ”´ OpenAIProviderç±»]
        A1 --> A6[ğŸ”´ ApiServiceå·¥å‚]
        A1 --> A7[ğŸ”´ é‡å¤ä»£ç å’Œé€»è¾‘æ··åˆ]
        
        style A1 fill:#ffcccc
        style A2 fill:#ffeeee
        style A3 fill:#ffeeee
        style A4 fill:#ffeeee
        style A5 fill:#ffeeee
        style A6 fill:#ffeeee
        style A7 fill:#ffeeee
    end
    
    subgraph "é‡æ„å - æ¨¡å—åŒ–æ¶æ„"
        B1[api/index.ts<br/>ç»Ÿä¸€å¯¼å‡º]
        
        subgraph "ç±»å‹å®šä¹‰"
            B2[types.ts<br/>æ¥å£å’Œç±»å‹]
        end
        
        subgraph "åŸºç¡€æ¶æ„"
            B3[base/BaseProvider.ts<br/>æŠ½è±¡åŸºç±»]
        end
        
        subgraph "å·¥å…·å‡½æ•°"
            B4[utils/apiUtils.ts<br/>APIå·¥å…·]
            B5[utils/textUtils.ts<br/>æ–‡æœ¬å¤„ç†]
            B6[utils/requestUtils.ts<br/>è¯·æ±‚å¤„ç†]
        end
        
        subgraph "Providerå®ç°"
            B7[providers/GoogleGeminiProvider.ts<br/>Geminiå®ç°]
            B8[providers/OpenAIProvider.ts<br/>OpenAIå®ç°]
            B9[providers/index.ts<br/>Providerå¯¼å‡º]
        end
        
        subgraph "å·¥å‚æ¨¡å¼"
            B10[factory/ApiServiceFactory.ts<br/>Providerå·¥å‚]
        end
        
        subgraph "ç°å·²åˆ é™¤"
            B11[âŒ ../apiService.ts<br/>å·²åˆ é™¤çš„å…¼å®¹æ–‡ä»¶]
        end
        
        B1 --> B2
        B1 --> B3
        B1 --> B4
        B1 --> B5
        B1 --> B6
        B1 --> B9
        B1 --> B10
        B7 --> B3
        B8 --> B3
        B9 --> B7
        B9 --> B8
        B10 --> B9
        
        style B1 fill:#ccffcc
        style B2 fill:#eeffee
        style B3 fill:#eeffee
        style B4 fill:#eeffee
        style B5 fill:#eeffee
        style B6 fill:#eeffee
        style B7 fill:#eeffee
        style B8 fill:#eeffee
        style B9 fill:#eeffee
        style B10 fill:#ccffcc
        style B11 fill:#ffcccc
    end
```

## ğŸ“š å¿«é€Ÿå¼€å§‹ - æ–°APIä½¿ç”¨æŒ‡å—

### åŸºç¡€ç¿»è¯‘æœåŠ¡ä½¿ç”¨

```typescript
// 1. å¯¼å…¥å¿…è¦çš„æ¨¡å—
import { ApiServiceFactory } from '@/src/modules/api';
import { StorageManager } from '@/src/modules/storageManager';

// 2. è·å–ç”¨æˆ·è®¾ç½®å’Œé…ç½®
const storageManager = new StorageManager();
const settings = await storageManager.getUserSettings();

// 3. è·å–å½“å‰æ´»è·ƒçš„APIé…ç½®
const activeConfig = settings.apiConfigs.find(
  config => config.id === settings.activeApiConfigId
);

// 4. åˆ›å»ºç¿»è¯‘æä¾›è€…
const provider = ApiServiceFactory.createProvider(activeConfig);

// 5. æ‰§è¡Œç¿»è¯‘
const result = await provider.analyzeFullText('Hello World', settings);
console.log(result.replacements); // æŸ¥çœ‹æ›¿æ¢ç»“æœ
```

### æ”¯æŒçš„Providerç±»å‹

```typescript
import { TranslationProvider } from '@/src/modules/types';

// æ”¯æŒçš„Providerç±»å‹
enum TranslationProvider {
  OpenAI = 'openai',           // OpenAI API
  GoogleGemini = 'gemini',     // Google Gemini API  
  ProxyGemini = 'proxy-gemini', // ä»£ç†Gemini API
  DeepSeek = 'deepseek',       // DeepSeek API
  SiliconFlow = 'siliconflow'  // SiliconFlow API
}
```

### æ£€æŸ¥å·¥å‚æ”¯æŒçš„Provider

```typescript
import { ApiServiceFactory } from '@/src/modules/api';

// è·å–æ”¯æŒçš„Provideråˆ—è¡¨
const supportedProviders = ApiServiceFactory.getSupportedProviders();
console.log('æ”¯æŒçš„Provider:', supportedProviders);

// æ£€æŸ¥ç‰¹å®šProvideræ˜¯å¦å—æ”¯æŒ
const isSupported = ApiServiceFactory.isProviderSupported(TranslationProvider.OpenAI);
console.log('OpenAIæ˜¯å¦æ”¯æŒ:', isSupported);
```

### é”™è¯¯å¤„ç†æœ€ä½³å®è·µ

```typescript
import { ApiServiceFactory, createErrorResponse } from '@/src/modules/api';

async function safeTranslate(text: string, settings: UserSettings) {
  try {
    const activeConfig = settings.apiConfigs.find(
      config => config.id === settings.activeApiConfigId
    );
    
    if (!activeConfig) {
      console.error('æœªæ‰¾åˆ°æ´»è·ƒçš„APIé…ç½®');
      return createErrorResponse(text);
    }
    
    const provider = ApiServiceFactory.createProvider(activeConfig);
    const result = await provider.analyzeFullText(text, settings);
    
    // æ£€æŸ¥ç»“æœæ˜¯å¦æœ‰æ•ˆ
    if (!result.replacements || result.replacements.length === 0) {
      console.warn('ç¿»è¯‘ç»“æœä¸ºç©º');
    }
    
    return result;
  } catch (error) {
    console.error('ç¿»è¯‘è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯:', error);
    return createErrorResponse(text);
  }
}
```

### è‡ªå®šä¹‰Providerå¼€å‘

```typescript
import { BaseProvider } from '@/src/modules/api';
import { UserSettings, FullTextAnalysisResponse, ApiConfig } from '@/src/modules/types';

// 1. ç»§æ‰¿BaseProvideråˆ›å»ºè‡ªå®šä¹‰Provider
class MyCustomProvider extends BaseProvider {
  protected getProviderName(): string {
    return 'My Custom Provider';
  }

  protected async doAnalyzeFullText(
    text: string,
    settings: UserSettings,
  ): Promise<FullTextAnalysisResponse> {
    // å®ç°è‡ªå®šä¹‰ç¿»è¯‘é€»è¾‘
    const replacements = await this.customTranslateLogic(text, settings);
    
    return {
      original: text,
      processed: '',
      replacements,
    };
  }

  private async customTranslateLogic(text: string, settings: UserSettings) {
    // è‡ªå®šä¹‰ç¿»è¯‘å®ç°
    // å¯ä»¥è°ƒç”¨ç¬¬ä¸‰æ–¹APIæˆ–æœ¬åœ°ç®—æ³•
    return [];
  }
}

// 2. æ‰©å±•å·¥å‚ä»¥æ”¯æŒæ–°Provider
// éœ€è¦åœ¨ ApiServiceFactory.ts ä¸­æ·»åŠ ï¼š
// case 'my-custom':
//   return new MyCustomProvider(config);
```

### é«˜çº§é…ç½®ç¤ºä¾‹

```typescript
import { ApiConfig, TranslationProvider } from '@/src/modules/types';

// å®Œæ•´çš„APIé…ç½®ç¤ºä¾‹
const customApiConfig: ApiConfig = {
  apiKey: 'your-api-key',
  apiEndpoint: 'https://api.custom-service.com/v1/chat/completions',
  model: 'gpt-4-turbo',
  temperature: 0.2,
  useBackgroundProxy: false,           // æ˜¯å¦ä½¿ç”¨åå°ä»£ç†
  requestsPerSecond: 2,               // æ¯ç§’è¯·æ±‚é™åˆ¶
  customParams: JSON.stringify({       // è‡ªå®šä¹‰å‚æ•°
    max_tokens: 1000,
    top_p: 0.9,
    frequency_penalty: 0.1
  }),
  includeThinkingParam: false,        // æ˜¯å¦åŒ…å«thinkingå‚æ•°
  enable_thinking: false              // å¯ç”¨thinkingæ¨¡å¼
};

// ä½¿ç”¨è‡ªå®šä¹‰é…ç½®
const provider = ApiServiceFactory.createProvider({
  id: 'custom-config',
  provider: TranslationProvider.OpenAI,
  config: customApiConfig
});
```