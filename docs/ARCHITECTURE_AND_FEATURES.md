# æµ¸å…¥å¼å­¦è¯­è¨€åŠ©æ‰‹ - æ¶æ„ä¸åŠŸèƒ½è¯¦è§£

## ğŸ“‹ ç›®å½•

- [é¡¹ç›®æ¦‚è§ˆ](#é¡¹ç›®æ¦‚è§ˆ)
- [æ ¸å¿ƒåŠŸèƒ½æ¨¡å—](#æ ¸å¿ƒåŠŸèƒ½æ¨¡å—)
- [æŠ€æœ¯æ¶æ„](#æŠ€æœ¯æ¶æ„)
- [APIå‚è€ƒ](#apiå‚è€ƒ)
- [å¼€å‘æŒ‡å—](#å¼€å‘æŒ‡å—)
- [æ€§èƒ½ä¸ä¼˜åŒ–](#æ€§èƒ½ä¸ä¼˜åŒ–)
- [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)

---

## ğŸ“– é¡¹ç›®æ¦‚è§ˆ

### æ ¸å¿ƒç†å¿µ

æµ¸å…¥å¼å­¦è¯­è¨€åŠ©æ‰‹åŸºäºè‘—åçš„ **"i+1"** ç†è®ºï¼ˆå¯ç†è§£è¾“å…¥ç†è®ºï¼‰ï¼Œé€šè¿‡æ™ºèƒ½åœ°å°†ç½‘é¡µå†…å®¹ä¸­çš„éƒ¨åˆ†è¯æ±‡æ›¿æ¢ä¸ºç›®æ ‡è¯­è¨€ï¼Œåˆ›é€ ä¸€ä¸ªæ²‰æµ¸å¼çš„è¯­è¨€å­¦ä¹ ç¯å¢ƒã€‚ç”¨æˆ·åœ¨æ—¥å¸¸æµè§ˆç½‘é¡µçš„è¿‡ç¨‹ä¸­ï¼Œè‡ªç„¶åœ°æ¥è§¦å’Œå­¦ä¹ æ–°çš„è¯æ±‡ï¼Œå®ç°"æ¶¦ç‰©ç»†æ— å£°"çš„è¯­è¨€å­¦ä¹ ä½“éªŒã€‚

**ğŸ¯ é¡¹ç›®äº®ç‚¹**: é›†æˆäº†å®Œæ•´çš„å‘éŸ³å­¦ä¹ ç”Ÿæ€ç³»ç»Ÿå’Œæ™ºèƒ½å¤šè¯­è¨€ç¿»è¯‘åŠŸèƒ½ï¼ŒåŒ…æ‹¬è‡ªåŠ¨è¯­è¨€æ£€æµ‹ã€éŸ³æ ‡æ˜¾ç¤ºã€AIè¯ä¹‰è§£é‡Šã€åŒTTSè¯­éŸ³åˆæˆå’Œäº¤äº’å¼æ‚¬æµ®æ¡†ï¼Œä¸ºç”¨æˆ·æä¾›ä»æ™ºèƒ½ç¿»è¯‘åˆ°å‘éŸ³å­¦ä¹ çš„ä¸€ç«™å¼æ²‰æµ¸å¼ä½“éªŒã€‚

### æŠ€æœ¯æ ˆ

- **å‰ç«¯æ¡†æ¶**: Vue 3 + TypeScript
- **æ„å»ºå·¥å…·**: WXT (WebExtensionæ¡†æ¶)
- **å¼€å‘å·¥å…·**: Vite + ESLint + Prettier
- **APIé›†æˆ**: OpenAIå…¼å®¹æ¥å£ã€Dictionary APIã€æœ‰é“TTS
- **æ¶æ„æ¨¡å¼**: Provideræ¨¡å¼ + æ¨¡å—åŒ–è®¾è®¡ + äº‹ä»¶é©±åŠ¨
- **å‘éŸ³ç³»ç»Ÿ**: å·¥å‚æ¨¡å¼ + å¤šTTSæœåŠ¡ + æ™ºèƒ½ç¼“å­˜
- **å¤šè¯­è¨€æ”¯æŒ**: 20+ç§è¯­è¨€çš„æ™ºèƒ½æ£€æµ‹å’Œç¿»è¯‘ï¼ˆç†è®ºåŸºäºAIæ¨¡å‹èƒ½åŠ›ï¼‰
- **æµè§ˆå™¨æ”¯æŒ**: Chromeã€Edgeã€Firefoxã€Safariï¼ˆéƒ¨åˆ†æ”¯æŒï¼‰

### æ•´ä½“æ¶æ„

```
æµ¸å…¥å¼å­¦è¯­è¨€åŠ©æ‰‹
â”œâ”€â”€ ğŸ¯ æ ¸å¿ƒç¿»è¯‘å¼•æ“
â”‚   â”œâ”€â”€ æ™ºèƒ½è¯­è¨€æ£€æµ‹ç³»ç»Ÿï¼ˆAIè‡ªåŠ¨è¯†åˆ«æºè¯­è¨€ï¼‰
â”‚   â”œâ”€â”€ æ™ºèƒ½æ–‡æœ¬å¤„ç†ç³»ç»Ÿï¼ˆLLMåˆ†æé€‰è¯ï¼‰
â”‚   â”œâ”€â”€ AIç¿»è¯‘æœåŠ¡ï¼ˆ20+ç§è¯­è¨€æ”¯æŒï¼‰
â”‚   â””â”€â”€ ç¼“å­˜ä¸æ€§èƒ½ä¼˜åŒ–
â”œâ”€â”€ ğŸ”Š å‘éŸ³å­¦ä¹ ç”Ÿæ€ç³»ç»Ÿ â­
â”‚   â”œâ”€â”€ éŸ³æ ‡è·å–æœåŠ¡ï¼ˆDictionary APIï¼‰
â”‚   â”œâ”€â”€ å¤šTTSè¯­éŸ³åˆæˆï¼ˆæœ‰é“TTS + Web Speechï¼‰
â”‚   â”œâ”€â”€ AIè¯ä¹‰è§£é‡Šï¼ˆå®æ—¶ç”Ÿæˆä¸­æ–‡é‡Šä¹‰ï¼‰
â”‚   â”œâ”€â”€ äº¤äº’å¼æ‚¬æµ®æ¡†ï¼ˆåŒå±‚å­¦ä¹ ä½“éªŒï¼‰
â”‚   â””â”€â”€ æ™ºèƒ½ç¼“å­˜æœºåˆ¶ï¼ˆ24å°æ—¶TTLéŸ³æ ‡ç¼“å­˜ï¼‰
â”œâ”€â”€ ğŸ¨ ç”¨æˆ·ç•Œé¢å±‚
â”‚   â”œâ”€â”€ Vue 3 å¼¹çª—è®¾ç½®ç•Œé¢
â”‚   â”œâ”€â”€ 7ç§ç¿»è¯‘æ ·å¼ç®¡ç†ï¼ˆå«å­¦ä¹ æ¨¡å¼ï¼‰
â”‚   â”œâ”€â”€ ä¸»é¢˜é€‚é…ç³»ç»Ÿï¼ˆæ·±è‰²/æµ…è‰²ï¼‰
â”‚   â””â”€â”€ å“åº”å¼æ‚¬æµ®æç¤ºç³»ç»Ÿ
â””â”€â”€ ğŸ”§ åŸºç¡€è®¾æ–½å±‚
    â”œâ”€â”€ è·¨è®¾å¤‡é…ç½®åŒæ­¥ï¼ˆStorage Managerï¼‰
    â”œâ”€â”€ æ‰©å±•æ¶ˆæ¯ä¼ é€’ç³»ç»Ÿ
    â”œâ”€â”€ è·¨æµè§ˆå™¨å…¼å®¹å±‚
    â””â”€â”€ æ€§èƒ½ç›‘æ§ä¸ä¼˜åŒ–
```

---

## ğŸš€ æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### 1. æ™ºèƒ½æ–‡æœ¬å¤„ç†ç³»ç»Ÿ

**ä½ç½®**: `src/modules/textProcessor.ts`

**æ ¸å¿ƒèŒè´£**:
- DOMæ ‘éå†å’Œæ–‡æœ¬èŠ‚ç‚¹æå–
- æ™ºèƒ½æ®µè½åˆ†ç»„å’Œé•¿åº¦æ§åˆ¶
- æ–‡æœ¬æ›¿æ¢çš„ç²¾ç¡®å®šä½å’Œåº”ç”¨
- åŠ¨æ€å†…å®¹ç›‘å¬å’Œå¤„ç†

**å…³é”®ç‰¹æ€§**:
```typescript
// æ ¸å¿ƒå¤„ç†æµç¨‹
public async processRoot(
  root: Node,
  textReplacer: TextReplacer,
  originalWordDisplayMode: OriginalWordDisplayMode,
  maxLength: number = 400
): Promise<void>
```

- **æ™ºèƒ½åˆ†ç»„**: æŒ‰è¯­ä¹‰å•å…ƒç»„ç»‡æ–‡æœ¬ï¼Œå¹³è¡¡å¤„ç†æ•ˆç‡å’Œä¸Šä¸‹æ–‡å®Œæ•´æ€§
- **å¢é‡å¤„ç†**: åªå¤„ç†æ–°å¢å†…å®¹ï¼Œé¿å…é‡å¤ç¿»è¯‘
- **DOMå®‰å…¨**: ä½¿ç”¨Range APIç¡®ä¿DOMç»“æ„å®Œæ•´æ€§
- **æ€§èƒ½ä¼˜åŒ–**: é˜²æŠ–æœºåˆ¶é¿å…é¢‘ç¹é‡å¤å¤„ç†

**å¿½ç•¥ç­–ç•¥**:
- è·³è¿‡ä»£ç å—ã€è„šæœ¬ã€æ ·å¼ç­‰æŠ€æœ¯å†…å®¹
- é¿å…å¤„ç†å·²ç¿»è¯‘æˆ–æ ‡è®°çš„å†…å®¹
- æ™ºèƒ½è¯†åˆ«å¹¶ä¿æŠ¤éšè—æˆ–ä¸å¯è§å…ƒç´ 

### 2. AIç¿»è¯‘æœåŠ¡

**ä½ç½®**: `src/modules/apiService.ts`

**æ ¸å¿ƒèŒè´£**:
- è°ƒç”¨å…¼å®¹OpenAI APIçš„å¤§è¯­è¨€æ¨¡å‹
- æ™ºèƒ½è¯æ±‡é€‰æ‹©å’Œéš¾åº¦é€‚é…
- ç»“æ„åŒ–ç¿»è¯‘ç»“æœå¤„ç†
- é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶

**APIæ¥å£è®¾è®¡**:
```typescript
interface FullTextAnalysisResponse {
  original: string;           // åŸå§‹æ–‡æœ¬
  processed: string;          // å¤„ç†åæ–‡æœ¬ï¼ˆå·²å¼ƒç”¨ï¼‰
  replacements: Replacement[]; // æ›¿æ¢é¡¹æ•°ç»„
}

interface Replacement {
  original: string;    // åŸæ–‡è¯æ±‡
  translation: string; // ç¿»è¯‘ç»“æœ
  position: {         // ä½ç½®ä¿¡æ¯
    start: number;
    end: number;
  };
  isNew: boolean;     // æ˜¯å¦ä¸ºç”Ÿè¯
  explanation?: string; // é¢å¤–è§£é‡Š
}
```

**æ™ºèƒ½ç¿»è¯‘ç­–ç•¥**:
- **æ™ºèƒ½è¯­è¨€æ£€æµ‹**: AIè‡ªåŠ¨è¯†åˆ«ç½‘é¡µæºè¯­è¨€ï¼Œæ— éœ€ç”¨æˆ·æ‰‹åŠ¨æŒ‡å®šè¯­è¨€ç±»å‹
- **éš¾åº¦é€‚é…**: æ ¹æ®ç”¨æˆ·è¯­è¨€æ°´å¹³è°ƒæ•´è¯æ±‡é€‰æ‹©
- **æ¯”ä¾‹æ§åˆ¶**: ç²¾ç¡®æ§åˆ¶ç¿»è¯‘è¯æ±‡å æ€»æ–‡æœ¬çš„æ¯”ä¾‹ï¼ˆ1%-100%å­—ç¬¦çº§ç²¾ç¡®è®¡ç®—ï¼‰
- **ä¸Šä¸‹æ–‡æ„ŸçŸ¥**: è€ƒè™‘è¯­å¢ƒé€‰æ‹©æœ€åˆé€‚çš„ç¿»è¯‘
- **å¤šè¯­è¨€æ”¯æŒ**: æ”¯æŒ20+ç§è¯­è¨€çš„æ™ºèƒ½ç¿»è¯‘ï¼ˆè‹±è¯­ã€æ—¥è¯­ã€éŸ©è¯­ã€æ³•è¯­ã€å¾·è¯­ã€è¥¿ç­ç‰™è¯­ã€ä¿„è¯­ã€æ„å¤§åˆ©è¯­ã€è‘¡è„ç‰™è¯­ã€è·å…°è¯­ã€ç‘å…¸è¯­ã€æŒªå¨è¯­ã€ä¸¹éº¦è¯­ã€èŠ¬å…°è¯­ã€æ³¢å…°è¯­ã€æ·å…‹è¯­ã€åœŸè€³å…¶è¯­ã€å¸Œè…Šè¯­ç­‰ï¼‰
- **æ™ºèƒ½å¤šè¯­è¨€æ¨¡å¼**: ç”¨æˆ·åªéœ€é€‰æ‹©ç›®æ ‡è¯­è¨€ï¼ŒAIè‡ªåŠ¨æ£€æµ‹æºè¯­è¨€å¹¶è¿›è¡Œç¿»è¯‘

### 3. å‘éŸ³ç”Ÿæ€ç³»ç»Ÿ

**ä½ç½®**: `src/modules/pronunciation/`

å‘éŸ³ç³»ç»Ÿæ˜¯é¡¹ç›®çš„ä¸€å¤§äº®ç‚¹ï¼Œé‡‡ç”¨æ¨¡å—åŒ–æ¶æ„è®¾è®¡ï¼Œæ”¯æŒå¤šç§éŸ³æ ‡å’Œè¯­éŸ³åˆæˆæœåŠ¡ã€‚

#### 3.1 éŸ³æ ‡æœåŠ¡æ¶æ„

```
pronunciation/
â”œâ”€â”€ phonetic/              # éŸ³æ ‡è·å–æ¨¡å—
â”‚   â”œâ”€â”€ IPhoneticProvider.ts       # éŸ³æ ‡æœåŠ¡æ¥å£
â”‚   â”œâ”€â”€ DictionaryApiProvider.ts   # Dictionary APIå®ç°
â”‚   â””â”€â”€ PhoneticProviderFactory.ts # éŸ³æ ‡æœåŠ¡å·¥å‚
â”œâ”€â”€ tts/                   # è¯­éŸ³åˆæˆæ¨¡å—
â”‚   â”œâ”€â”€ ITTSProvider.ts            # TTSæœåŠ¡æ¥å£
â”‚   â”œâ”€â”€ WebSpeechTTSProvider.ts    # Web Speech APIå®ç°
â”‚   â”œâ”€â”€ YoudaoTTSProvider.ts       # æœ‰é“TTSå®ç°
â”‚   â””â”€â”€ TTSProviderFactory.ts      # TTSæœåŠ¡å·¥å‚
â”œâ”€â”€ translation/           # AIç¿»è¯‘æ¨¡å—
â”‚   â””â”€â”€ AITranslationProvider.ts   # AIè¯ä¹‰è·å–
â”œâ”€â”€ services/              # æ ¸å¿ƒæœåŠ¡å±‚
â”‚   â”œâ”€â”€ PronunciationService.ts    # å‘éŸ³æœåŠ¡åè°ƒå™¨
â”‚   â””â”€â”€ TTSService.ts              # TTSæœåŠ¡ç®¡ç†å™¨
â”œâ”€â”€ ui/                    # ç”¨æˆ·ç•Œé¢ç»„ä»¶
â”‚   â”œâ”€â”€ TooltipRenderer.ts         # æ‚¬æµ®æ¡†æ¸²æŸ“å™¨
â”‚   â””â”€â”€ EventManager.ts            # äº‹ä»¶ç®¡ç†å™¨
â””â”€â”€ utils/                 # å·¥å…·å‡½æ•°
    â”œâ”€â”€ DOMUtils.ts               # DOMæ“ä½œå·¥å…·
    â”œâ”€â”€ PositionUtils.ts          # ä½ç½®è®¡ç®—å·¥å…·
    â””â”€â”€ TimerManager.ts           # å®šæ—¶å™¨ç®¡ç†
```

#### 3.2 PronunciationServiceæ ¸å¿ƒåŠŸèƒ½

**ä¸»è¦èŒè´£**:
- åè°ƒéŸ³æ ‡è·å–ã€AIç¿»è¯‘å’Œè¯­éŸ³åˆæˆ
- ç®¡ç†æ‚¬æµ®æ¡†çš„æ˜¾ç¤ºå’Œéšè—é€»è¾‘
- æä¾›åŒå±‚äº¤äº’ä½“éªŒï¼ˆçŸ­è¯­â†’å•è¯ï¼‰
- å®ç°æ™ºèƒ½ç¼“å­˜å’Œæ€§èƒ½ä¼˜åŒ–

**æ ¸å¿ƒæ–¹æ³•**:
```typescript
// ä¸ºç¿»è¯‘å…ƒç´ æ·»åŠ å‘éŸ³åŠŸèƒ½
async addPronunciationToElement(
  element: HTMLElement,
  word: string,
  isPhrase?: boolean
): Promise<boolean>

// è¯­éŸ³åˆæˆï¼ˆæ”¯æŒä¸»å¤‡åŒTTSï¼‰
async speakText(text: string): Promise<TTSResult>

// è·å–éŸ³æ ‡ä¿¡æ¯
async getPhonetic(word: string): Promise<PhoneticResult>
```

#### 3.3 äº¤äº’å¼æ‚¬æµ®æ¡†ç³»ç»Ÿ

**æ‚¬æµ®æ¡†ç±»å‹**:
1. **å•è¯æ‚¬æµ®æ¡†**: æ˜¾ç¤ºéŸ³æ ‡ã€AIè¯ä¹‰ã€æœ—è¯»æŒ‰é’®
2. **çŸ­è¯­æ‚¬æµ®æ¡†**: æ˜¾ç¤ºå¯äº¤äº’çš„å•è¯åˆ—è¡¨
3. **åµŒå¥—æ‚¬æµ®æ¡†**: çŸ­è¯­ä¸­å•ä¸ªå•è¯çš„è¯¦ç»†ä¿¡æ¯

**æ™ºèƒ½æ˜¾ç¤ºé€»è¾‘**:
- æ¸è¿›å¼åŠ è½½ï¼šå…ˆæ˜¾ç¤ºåŸºç¡€ä¿¡æ¯ï¼Œå†å¼‚æ­¥åŠ è½½è¯¦ç»†å†…å®¹
- æ™ºèƒ½å®šä½ï¼šè‡ªåŠ¨è®¡ç®—æœ€ä½³æ˜¾ç¤ºä½ç½®ï¼Œé¿å…è¾¹ç•Œæº¢å‡º
- äº¤äº’ä¼˜åŒ–ï¼šæ”¯æŒé¼ æ ‡æ‚¬åœå»¶è¿Ÿã€ç‚¹å‡»å›ºå®šç­‰äº¤äº’æ¨¡å¼

### 4. æ ·å¼ç®¡ç†ç³»ç»Ÿ

**ä½ç½®**: `src/modules/styleManager.ts`

**æ ¸å¿ƒåŠŸèƒ½**:
- åŠ¨æ€CSSæ³¨å…¥å’Œç®¡ç†
- å¤šç§ç¿»è¯‘æ˜¾ç¤ºæ ·å¼æ”¯æŒ
- ä¸»é¢˜é€‚é…å’Œå“åº”å¼è®¾è®¡
- åŠ¨ç”»æ•ˆæœå’Œäº¤äº’åé¦ˆ

**æ”¯æŒçš„æ ·å¼ç±»å‹**:
```typescript
enum TranslationStyle {
  DEFAULT = 'default',      // é»˜è®¤è“è‰²æ ·å¼
  SUBTLE = 'subtle',        // å¾®å¦™ç°è‰²æ ·å¼
  BOLD = 'bold',           // ç²—ä½“æ ·å¼
  ITALIC = 'italic',       // æ–œä½“æ ·å¼
  UNDERLINED = 'underlined', // ä¸‹åˆ’çº¿æ ·å¼
  HIGHLIGHTED = 'highlighted', // é«˜äº®æ ·å¼
  LEARNING = 'learning'     // å­¦ä¹ æ¨¡å¼ï¼ˆæ¨¡ç³Šæ•ˆæœï¼‰
}
```

**é«˜çº§æ ·å¼ç‰¹æ€§**:
- **è¾‰å…‰åŠ¨ç”»**: æ–°ç¿»è¯‘è¯æ±‡å‡ºç°æ—¶çš„æŸ”å’Œæç¤ºæ•ˆæœï¼Œä¸å¹²æ‰°é˜…è¯»ä½“éªŒ
- **å­¦ä¹ æ¨¡å¼**: ç¿»è¯‘è¯æ±‡åˆå§‹æ¨¡ç³Šæ˜¾ç¤ºï¼Œé¼ æ ‡æ‚¬åœæ—¶æ¸…æ™°åŒ–ï¼Œå¢å¼ºè®°å¿†æ•ˆæœ
- **å“åº”å¼è®¾è®¡**: è‡ªé€‚åº”æ·±è‰²/æµ…è‰²ä¸»é¢˜ï¼Œæ™ºèƒ½æ‚¬æµ®æ¡†å®šä½
- **æ— éšœç¢æ”¯æŒ**: è€ƒè™‘è‰²å½©å¯¹æ¯”åº¦å’Œå¯è¯»æ€§



### 5. é…ç½®ä¸å­˜å‚¨ç®¡ç†

**ä½ç½®**: `src/modules/storageManager.ts`, `src/modules/types.ts`

**æ•°æ®æ¨¡å‹**:
```typescript
interface UserSettings {
  userLevel: UserLevel;                    // ç”¨æˆ·è¯­è¨€æ°´å¹³ï¼ˆ5ä¸ªçº§åˆ«ï¼‰
  replacementRate: number;                 // ç¿»è¯‘æ¯”ä¾‹ï¼ˆ1%-100%ï¼‰
  isEnabled: boolean;                      // åŠŸèƒ½å¼€å…³
  useGptApi: boolean;                      // ä½¿ç”¨AIç¿»è¯‘
  apiConfig: ApiConfig;                    // APIé…ç½®
  translationStyle: TranslationStyle;      // ç¿»è¯‘æ ·å¼ï¼ˆ7ç§æ ·å¼ï¼‰
  triggerMode: TriggerMode;                // è§¦å‘æ¨¡å¼ï¼ˆè‡ªåŠ¨/æ‰‹åŠ¨ï¼‰
  maxLength: number;                       // æ®µè½æœ€å¤§é•¿åº¦
  translationDirection: string;            // ç¿»è¯‘æ–¹å‘/æ™ºèƒ½å¤šè¯­è¨€æ¨¡å¼
  originalWordDisplayMode: OriginalWordDisplayMode; // åŸæ–‡æ˜¾ç¤ºæ¨¡å¼
  enablePronunciationTooltip: boolean;     // å‘éŸ³æ‚¬æµ®æ¡†å¼€å…³
}

interface ApiConfig {
  apiKey: string;                          // APIå¯†é’¥
  apiEndpoint: string;                     // APIç«¯ç‚¹
  model: string;                           // æ¨¡å‹åç§°
  temperature: number;                     // æ¸©åº¦å‚æ•°ï¼ˆé»˜è®¤0.2ï¼‰
}
```

**å­˜å‚¨ç­–ç•¥**:
- ä½¿ç”¨ `browser.storage.sync` å®ç°è·¨è®¾å¤‡åŒæ­¥
- å‘åå…¼å®¹çš„é…ç½®è¿ç§»æœºåˆ¶
- é»˜è®¤å€¼ä¿æŠ¤å’Œé”™è¯¯æ¢å¤
- å®æ—¶é…ç½®æ›´æ–°å’Œæ¶ˆæ¯ä¼ é€’

---

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### æ¨¡å—åŒ–è®¾è®¡åŸåˆ™

é¡¹ç›®é‡‡ç”¨é«˜åº¦æ¨¡å—åŒ–çš„æ¶æ„ï¼Œæ¯ä¸ªæ¨¡å—éƒ½æœ‰æ˜ç¡®çš„èŒè´£è¾¹ç•Œå’Œæ ‡å‡†åŒ–çš„æ¥å£ã€‚

#### 1. åˆ†å±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ç”¨æˆ·ç•Œé¢å±‚ (UI Layer)         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Popup UI  â”‚ â”‚ Content Styles  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          æœåŠ¡å±‚ (Service Layer)        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚Pronunciationâ”‚ â”‚  Text Processor â”‚ â”‚
â”‚  â”‚   Service   â”‚ â”‚                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         æä¾›è€…å±‚ (Provider Layer)      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ API Service â”‚ â”‚   TTS/Phonetic  â”‚ â”‚
â”‚  â”‚             â”‚ â”‚    Providers    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         åŸºç¡€è®¾æ–½å±‚ (Infrastructure)    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Storage   â”‚ â”‚    Messaging    â”‚ â”‚
â”‚  â”‚   Manager   â”‚ â”‚     System      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2. Provideræ¨¡å¼å®ç°

æ‰€æœ‰å¤–éƒ¨æœåŠ¡éƒ½é€šè¿‡Provideræ¨¡å¼æŠ½è±¡ï¼š

```typescript
// ç»Ÿä¸€çš„Provideræ¥å£
interface IPhoneticProvider {
  getName(): string;
  getPhonetic(word: string): Promise<PhoneticResult>;
}

// å·¥å‚æ¨¡å¼åˆ›å»ºProviderå®ä¾‹
class PhoneticProviderFactory {
  static createProvider(providerName: string): IPhoneticProvider {
    switch (providerName) {
      case 'dictionary-api':
        return new DictionaryApiProvider();
      default:
        throw new Error(`Unknown provider: ${providerName}`);
    }
  }
}
```

#### 3. äº‹ä»¶é©±åŠ¨æ¶æ„

ç³»ç»Ÿé‡‡ç”¨äº‹ä»¶é©±åŠ¨çš„æ¶ˆæ¯ä¼ é€’æœºåˆ¶ï¼š

```typescript
// æ¶ˆæ¯ç±»å‹å®šä¹‰
interface MessageTypes {
  'settings_updated': { settings: UserSettings };
  'MANUAL_TRANSLATE': {};
  'validate-configuration': { source: string };
}

// ç»Ÿä¸€çš„æ¶ˆæ¯å¤„ç†
browser.runtime.onMessage.addListener((message, sender, sendResponse) => {
  switch (message.type) {
    case 'settings_updated':
      handleSettingsUpdate(message.settings);
      break;
    // ... å…¶ä»–æ¶ˆæ¯å¤„ç†
  }
});
```

### æ•°æ®æµè®¾è®¡

#### 1. ç¿»è¯‘å¤„ç†æµç¨‹

```
ç”¨æˆ·è®¿é—®ç½‘é¡µ
    â†“
DOMå†…å®¹è§£æå’Œæ–‡æœ¬æå–
    â†“
æ–‡æœ¬åˆ†ç»„å’Œé•¿åº¦æ§åˆ¶
    â†“
AI APIè°ƒç”¨å’Œç¿»è¯‘è·å–
    â†“
æ›¿æ¢ç»“æœå®šä½å’Œåº”ç”¨
    â†“
æ ·å¼åº”ç”¨å’ŒåŠ¨ç”»æ•ˆæœ
    â†“
å‘éŸ³åŠŸèƒ½æ³¨å†Œï¼ˆå¯é€‰ï¼‰
```

#### 2. å‘éŸ³æœåŠ¡æµç¨‹

```
ç”¨æˆ·é¼ æ ‡æ‚¬åœç¿»è¯‘è¯æ±‡
    â†“
è§¦å‘å‘éŸ³æœåŠ¡æ³¨å†Œ
    â†“
å¹¶è¡Œå¼‚æ­¥åŠ è½½ï¼š
â”œâ”€ éŸ³æ ‡è·å– (Dictionary API)
â”œâ”€ AIè¯ä¹‰è·å– (OpenAI API)
â””â”€ TTSæœåŠ¡å‡†å¤‡ (æœ‰é“/Web Speech)
    â†“
æ¸²æŸ“æ‚¬æµ®æ¡†ç•Œé¢
    â†“
ç”¨æˆ·äº¤äº’ï¼šæ’­æ”¾è¯­éŸ³ã€æŸ¥çœ‹è¯ä¹‰
```

### æ‰©å±•æ€§æœºåˆ¶

#### 1. æ’ä»¶å¼Provider

æ–°çš„APIæœåŠ¡å¯ä»¥é€šè¿‡å®ç°æ ‡å‡†æ¥å£è½»æ¾é›†æˆï¼š

```typescript
// æ–°å¢ç¿»è¯‘æœåŠ¡
class NewTranslationProvider implements ITranslationProvider {
  async translate(text: string, options: TranslationOptions): Promise<TranslationResult> {
    // å®ç°å…·ä½“ç¿»è¯‘é€»è¾‘
  }
}

// åœ¨å·¥å‚ä¸­æ³¨å†Œ
TranslationProviderFactory.register('new-service', NewTranslationProvider);
```

#### 2. ä¸»é¢˜å’Œæ ·å¼æ‰©å±•

æ ·å¼ç³»ç»Ÿæ”¯æŒè‡ªå®šä¹‰ä¸»é¢˜ï¼š

```typescript
// æ–°å¢ç¿»è¯‘æ ·å¼
enum CustomTranslationStyle {
  NEON = 'neon',
  GRADIENT = 'gradient'
}

// åœ¨æ ·å¼ç®¡ç†å™¨ä¸­æ³¨å†Œ
styleManager.registerStyle('neon', {
  color: '#00ff00',
  textShadow: '0 0 10px #00ff00'
});
```

---

## ğŸ”Œ APIå‚è€ƒ

### ç”¨æˆ·è®¾ç½®API

#### è·å–ç”¨æˆ·è®¾ç½®
```typescript
const storageManager = new StorageManager();
const settings = await storageManager.getUserSettings();
```

#### ä¿å­˜ç”¨æˆ·è®¾ç½®
```typescript
await storageManager.saveUserSettings({
  userLevel: UserLevel.INTERMEDIATE,
  replacementRate: 0.3,
  translationStyle: TranslationStyle.HIGHLIGHTED
});
```

#### è®¾ç½®æ›´æ–°é€šçŸ¥
```typescript
import { notifySettingsChanged } from '@/src/modules/messaging';

await notifySettingsChanged(newSettings);
```

### å‘éŸ³æœåŠ¡API

#### åˆå§‹åŒ–å‘éŸ³æœåŠ¡
```typescript
import { PronunciationService, DEFAULT_PRONUNCIATION_CONFIG } from '@/src/modules/pronunciation';

const pronunciationService = new PronunciationService({
  ...DEFAULT_PRONUNCIATION_CONFIG,
  uiConfig: {
    tooltipEnabled: true,
    showPhonetic: true,
    showPlayButton: true
  }
});
```

#### ä¸ºå…ƒç´ æ·»åŠ å‘éŸ³åŠŸèƒ½
```typescript
await pronunciationService.addPronunciationToElement(
  element,           // HTMLå…ƒç´ 
  'hello world',     // å•è¯æˆ–çŸ­è¯­
  false             // æ˜¯å¦ä¸ºçŸ­è¯­
);
```

#### è¯­éŸ³åˆæˆ
```typescript
// ä½¿ç”¨é»˜è®¤TTS
const result = await pronunciationService.speakText('Hello World');

// æŒ‡å®šå£éŸ³
const result = await pronunciationService.speakTextWithAccent('Hello', 'en-GB');
```

#### è·å–éŸ³æ ‡
```typescript
const phoneticResult = await pronunciationService.getPhonetic('hello');
console.log(phoneticResult.phonetics[0].text); // "/hÉ™ËˆloÊŠ/"
```

### æ–‡æœ¬å¤„ç†API

#### å¤„ç†é¡µé¢å†…å®¹
```typescript
const textProcessor = new TextProcessor(true); // å¯ç”¨å‘éŸ³åŠŸèƒ½
const textReplacer = new TextReplacer(config);

await textProcessor.processRoot(
  document.body,                           // æ ¹èŠ‚ç‚¹
  textReplacer,                           // æ–‡æœ¬æ›¿æ¢å™¨
  OriginalWordDisplayMode.VISIBLE,        // åŸæ–‡æ˜¾ç¤ºæ¨¡å¼
  400                                     // æœ€å¤§æ®µè½é•¿åº¦
);
```

#### æ›¿æ¢æ–‡æœ¬
```typescript
const textReplacer = new TextReplacer(config);
const result = await textReplacer.replaceText("è¿™æ˜¯ä¸€æ®µä¸­æ–‡æ–‡æœ¬");

console.log(result.replacements); // æ›¿æ¢é¡¹æ•°ç»„
```

### æ ·å¼ç®¡ç†API

#### è®¾ç½®ç¿»è¯‘æ ·å¼
```typescript
const styleManager = new StyleManager();
styleManager.setTranslationStyle(TranslationStyle.HIGHLIGHTED);
```

#### è·å–å½“å‰æ ·å¼ç±»å
```typescript
const className = styleManager.getCurrentStyleClass();
// è¿”å›: "wxt-style-highlighted"
```

---

## ğŸ’» å¼€å‘æŒ‡å—

### ç¯å¢ƒé…ç½®

#### 1. ç³»ç»Ÿè¦æ±‚
- Node.js 18+ 
- npm æˆ– pnpm
- æ”¯æŒWebExtensionçš„æµè§ˆå™¨

#### 2. å®‰è£…ä¾èµ–
```bash
git clone https://github.com/xiao-zaiyi/illa-helper.git
cd illa-helper
npm install
```

#### 3. ç¯å¢ƒå˜é‡é…ç½®
```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
cp .env.example .env

# ç¼–è¾‘é…ç½®æ–‡ä»¶
# è‡³å°‘éœ€è¦é…ç½®APIå¯†é’¥
    VITE_WXT_DEFAULT_API_KEY="sk-your-api-key"
    VITE_WXT_DEFAULT_API_ENDPOINT="https://api.openai.com/v1/chat/completions"
    VITE_WXT_DEFAULT_MODEL="gpt-4"
    VITE_WXT_DEFAULT_TEMPERATURE="0.2"
```

#### 4. å¼€å‘è¿è¡Œ
```bash
# å¼€å‘æ¨¡å¼ï¼ˆChromeï¼‰
npm run dev

# å¼€å‘æ¨¡å¼ï¼ˆFirefoxï¼‰
npm run dev:firefox

# ç”Ÿäº§æ„å»º
npm run build

# æ‰“åŒ…æ‰©å±•
npm run zip
```

### ä»£ç ç»“æ„è§„èŒƒ

#### 1. ç›®å½•ç»„ç»‡
```
src/modules/
â”œâ”€â”€ [åŠŸèƒ½æ¨¡å—]/
â”‚   â”œâ”€â”€ index.ts          # æ¨¡å—ä¸»å…¥å£
â”‚   â”œâ”€â”€ types.ts          # ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ config.ts         # é…ç½®å¸¸é‡
â”‚   â”œâ”€â”€ services/         # æœåŠ¡å±‚
â”‚   â”œâ”€â”€ providers/        # æä¾›è€…å®ç°
â”‚   â””â”€â”€ utils/           # å·¥å…·å‡½æ•°
```

#### 2. å‘½åè§„èŒƒ
- **æ–‡ä»¶å**: ä½¿ç”¨PascalCaseï¼ˆå¦‚ `TextProcessor.ts`ï¼‰
- **ç±»å**: PascalCaseï¼ˆå¦‚ `class TextProcessor`ï¼‰
- **æ¥å£å**: ä»¥ `I` å¼€å¤´ï¼ˆå¦‚ `interface IPhoneticProvider`ï¼‰
- **æ–¹æ³•å**: camelCaseï¼ˆå¦‚ `processText()`ï¼‰
- **å¸¸é‡**: UPPER_SNAKE_CASEï¼ˆå¦‚ `DEFAULT_CONFIG`ï¼‰

#### 3. TypeScriptè§„èŒƒ
```typescript
// ä½¿ç”¨ä¸¥æ ¼çš„ç±»å‹å®šä¹‰
interface StrictInterface {
  required: string;
  optional?: number;
}

// é¿å…ä½¿ç”¨ anyï¼Œä½¿ç”¨æ³›å‹
function processData<T>(data: T): Promise<T> {
  return Promise.resolve(data);
}

// ä½¿ç”¨è”åˆç±»å‹è€Œéå­—ç¬¦ä¸²
type Theme = 'light' | 'dark' | 'auto';
```

### æ–°åŠŸèƒ½å¼€å‘æµç¨‹

#### 1. æ·»åŠ æ–°çš„Provider
```typescript
// 1. å®šä¹‰æ¥å£ï¼ˆå¦‚æœéœ€è¦ï¼‰
interface INewProvider {
  process(input: string): Promise<Result>;
}

// 2. å®ç°Provider
class NewProvider implements INewProvider {
  async process(input: string): Promise<Result> {
    // å®ç°é€»è¾‘
  }
}

// 3. åœ¨å·¥å‚ä¸­æ³¨å†Œ
export class ProviderFactory {
  static createProvider(type: string): INewProvider {
    switch (type) {
      case 'new':
        return new NewProvider();
      default:
        throw new Error(`Unknown provider: ${type}`);
    }
  }
}

// 4. æ·»åŠ åˆ°æ¨¡å—å¯¼å‡º
export { NewProvider } from './NewProvider';
```

#### 2. æ·»åŠ æ–°çš„æ ·å¼
```typescript
// 1. æ‰©å±•æ ·å¼æšä¸¾
enum TranslationStyle {
  // ... ç°æœ‰æ ·å¼
  NEW_STYLE = 'new-style'
}

// 2. åœ¨æ ·å¼ç®¡ç†å™¨ä¸­æ·»åŠ CSS
private initializeStyles(): void {
  const styleElement = document.createElement('style');
  styleElement.textContent = `
    /* ... ç°æœ‰æ ·å¼ */
    .wxt-style-new-style {
      /* æ–°æ ·å¼å®šä¹‰ */
    }
  `;
}
```

#### 3. æ·»åŠ æ–°çš„é…ç½®é€‰é¡¹
```typescript
// 1. æ‰©å±•ç”¨æˆ·è®¾ç½®æ¥å£
interface UserSettings {
  // ... ç°æœ‰è®¾ç½®
  newOption: boolean;
}

// 2. æ›´æ–°é»˜è®¤è®¾ç½®
const DEFAULT_SETTINGS: UserSettings = {
  // ... ç°æœ‰é»˜è®¤å€¼
  newOption: false
};

// 3. åœ¨UIä¸­æ·»åŠ æ§åˆ¶ç»„ä»¶
<div class="setting-group">
  <label>æ–°åŠŸèƒ½é€‰é¡¹</label>
  <input type="checkbox" v-model="settings.newOption" />
</div>
```

### æµ‹è¯•æŒ‡å—

#### 1. æ‰‹åŠ¨æµ‹è¯•æ£€æŸ¥æ¸…å•
- [ ] åŸºæœ¬ç¿»è¯‘åŠŸèƒ½åœ¨ä¸åŒç±»å‹ç½‘ç«™ä¸Šå·¥ä½œæ­£å¸¸
- [ ] æ™ºèƒ½è¯­è¨€æ£€æµ‹åŠŸèƒ½æ­£ç¡®è¯†åˆ«ç½‘é¡µæºè¯­è¨€
- [ ] æ™ºèƒ½å¤šè¯­è¨€æ¨¡å¼ç¿»è¯‘å‡†ç¡®ï¼ˆæµ‹è¯•ä¸­è‹±æ—¥éŸ©ç­‰è¯­è¨€ï¼‰
- [ ] å‘éŸ³åŠŸèƒ½éŸ³æ ‡æ˜¾ç¤ºæ­£ç¡®ï¼ˆDictionary APIï¼‰
- [ ] TTSè¯­éŸ³æ’­æ”¾æ­£å¸¸ï¼ˆæµ‹è¯•æœ‰é“TTS + Web SpeechåŒTTSï¼‰
- [ ] æ‚¬æµ®æ¡†å®šä½å’Œäº¤äº’å“åº”æ­£ç¡®ï¼ˆé¿å…è¾¹ç•Œæº¢å‡ºï¼‰
- [ ] åŒå±‚å­¦ä¹ ä½“éªŒæ­£å¸¸ï¼ˆçŸ­è¯­â†’å•è¯äº¤äº’ï¼‰
- [ ] 7ç§ç¿»è¯‘æ ·å¼æ˜¾ç¤ºæ­£å¸¸ï¼ˆå«å­¦ä¹ æ¨¡å¼æ¨¡ç³Šæ•ˆæœï¼‰
- [ ] ä¸»é¢˜é€‚é…æ­£å¸¸ï¼ˆæ·±è‰²/æµ…è‰²è‡ªåŠ¨åˆ‡æ¢ï¼‰
- [ ] è®¾ç½®ä¿å­˜å’Œè·¨è®¾å¤‡åŒæ­¥åŠŸèƒ½æ­£å¸¸
- [ ] 20+ç§è¯­è¨€ç¿»è¯‘æ–¹å‘æ­£ç¡®
- [ ] æ€§èƒ½è¡¨ç°è‰¯å¥½ï¼ˆå¤§é¡µé¢ã€åŠ¨æ€å†…å®¹ã€ç¼“å­˜æœºåˆ¶ï¼‰

#### 2. è°ƒè¯•æŠ€å·§
```typescript
// å¯ç”¨è°ƒè¯•æ—¥å¿—
localStorage.setItem('wxt-debug', 'true');

// æ£€æŸ¥ç¼“å­˜çŠ¶æ€
console.log('Cache status:', pronunciationService.getCacheStatus());

// éªŒè¯é…ç½®
console.log('Current settings:', await storageManager.getUserSettings());
```

### å‘å¸ƒæµç¨‹

#### 1. ç‰ˆæœ¬å‘å¸ƒå‡†å¤‡
```bash
# 1. æ›´æ–°ç‰ˆæœ¬å·
# ç¼–è¾‘ wxt.config.ts ä¸­çš„ manifest.version

# 2. æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build

# 3. åˆ›å»ºå‘å¸ƒåŒ…
npm run zip
```

#### 2. å•†åº—å‘å¸ƒ
- **Chrome Web Store**: ä¸Šä¼  `.output/chrome-mv3.zip`
- **Edge Add-ons**: ä¸Šä¼ ç›¸åŒçš„ChromeåŒ…
- **Firefox**: ä½¿ç”¨ `npm run build:firefox && npm run zip:firefox`

---

## âš¡ æ€§èƒ½ä¸ä¼˜åŒ–

### ç¼“å­˜ç­–ç•¥

#### 1. ç¿»è¯‘ç»“æœç¼“å­˜
- **ç¼“å­˜é”®**: åŸºäºæ–‡æœ¬å†…å®¹å’Œç”¨æˆ·è®¾ç½®çš„å“ˆå¸Œ
- **ç¼“å­˜æ—¶é—´**: ä¼šè¯çº§ç¼“å­˜ï¼Œæµè§ˆå™¨å…³é—­åæ¸…é™¤
- **ç¼“å­˜å¤§å°**: ä½¿ç”¨LRUç®—æ³•ï¼Œæœ€å¤šç¼“å­˜1000ä¸ªç¿»è¯‘ç»“æœ

#### 2. å‘éŸ³æ•°æ®ç¼“å­˜
- **éŸ³æ ‡ç¼“å­˜**: 24å°æ—¶TTLï¼Œå­˜å‚¨åœ¨ `localStorage`
- **TTSç¼“å­˜**: å†…å­˜çº§ç¼“å­˜ï¼Œé¿å…é‡å¤éŸ³é¢‘ç”Ÿæˆ
- **AIè¯ä¹‰ç¼“å­˜**: 1å°æ—¶TTLï¼Œå‡å°‘APIè°ƒç”¨

### æ€§èƒ½ä¼˜åŒ–

#### 1. DOMæ“ä½œä¼˜åŒ–
```typescript
// æ‰¹é‡DOMæ›´æ–°
const fragment = document.createDocumentFragment();
// æ·»åŠ æ‰€æœ‰å…ƒç´ åˆ°fragment
element.appendChild(fragment);

// ä½¿ç”¨Range APIç²¾ç¡®æ›¿æ¢
const range = document.createRange();
range.setStart(textNode, startOffset);
range.setEnd(textNode, endOffset);
```

#### 2. å¼‚æ­¥å¤„ç†ä¼˜åŒ–
```typescript
// å¹¶è¡ŒåŠ è½½éŸ³æ ‡å’Œè¯ä¹‰
const [phoneticResult, aiTranslation] = await Promise.allSettled([
  this.phoneticProvider.getPhonetic(word),
  this.aiTranslationProvider.getTranslation(word)
]);
```

#### 3. å†…å­˜ç®¡ç†
- åŠæ—¶æ¸…ç†äº‹ä»¶ç›‘å¬å™¨
- å®šæœŸæ¸…ç†è¿‡æœŸç¼“å­˜
- ä½¿ç”¨WeakMapå­˜å‚¨DOMç›¸å…³æ•°æ®

### ç›‘æ§æŒ‡æ ‡

#### 1. æ€§èƒ½æŒ‡æ ‡
- ç¿»è¯‘å¤„ç†æ—¶é—´ï¼ˆç›®æ ‡: <2ç§’ï¼‰
- æ‚¬æµ®æ¡†å“åº”æ—¶é—´ï¼ˆç›®æ ‡: <500msï¼‰
- å†…å­˜ä½¿ç”¨é‡ï¼ˆç›®æ ‡: <50MBï¼‰
- APIè°ƒç”¨æˆåŠŸç‡ï¼ˆç›®æ ‡: >95%ï¼‰

#### 2. ç”¨æˆ·ä½“éªŒæŒ‡æ ‡
- ç¿»è¯‘å‡†ç¡®ç‡
- å‘éŸ³åŠŸèƒ½ä½¿ç”¨ç‡
- è®¾ç½®ä¿å­˜æˆåŠŸç‡
- é”™è¯¯å‘ç”Ÿé¢‘ç‡

---

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. APIé…ç½®é—®é¢˜
**ç—‡çŠ¶**: ç¿»è¯‘åŠŸèƒ½ä¸å·¥ä½œï¼Œæ˜¾ç¤ºAPIé…ç½®é”™è¯¯é€šçŸ¥
**è§£å†³æ–¹æ¡ˆ**:
```typescript
// æ£€æŸ¥APIé…ç½®
const settings = await browser.storage.sync.get('apiConfig');
console.log('API Config:', settings.apiConfig);

// éªŒè¯APIå¯†é’¥æ ¼å¼
if (!settings.apiConfig?.apiKey?.startsWith('sk-')) {
  console.error('Invalid API key format');
}
```

#### 2. å‘éŸ³åŠŸèƒ½æ— æ³•ä½¿ç”¨
**ç—‡çŠ¶**: æ‚¬æµ®æ¡†æ˜¾ç¤ºä½†éŸ³æ ‡æˆ–TTSä¸å·¥ä½œ
**è§£å†³æ–¹æ¡ˆ**:
```typescript
// æ£€æŸ¥TTSæœåŠ¡çŠ¶æ€
const ttsStatus = pronunciationService.getTTSProviderStatus();
console.log('TTS Status:', ttsStatus);

// æ£€æŸ¥æµè§ˆå™¨TTSæ”¯æŒ
if ('speechSynthesis' in window) {
  console.log('Web Speech API supported');
} else {
  console.warn('Web Speech API not supported');
}
```

#### 3. æ ·å¼æ˜¾ç¤ºå¼‚å¸¸
**ç—‡çŠ¶**: ç¿»è¯‘æ–‡æœ¬æ ·å¼ä¸æ­£ç¡®æˆ–å†²çª
**è§£å†³æ–¹æ¡ˆ**:
```typescript
// æ£€æŸ¥æ ·å¼æ³¨å…¥
const styleSheets = document.querySelectorAll('style[data-wxt]');
console.log('Injected styles:', styleSheets.length);

// æ£€æŸ¥æ ·å¼ç±»å
const translatedElements = document.querySelectorAll('[class*="wxt-style"]');
console.log('Styled elements:', translatedElements.length);
```

#### 4. æƒé™é—®é¢˜
**ç—‡çŠ¶**: æ‰©å±•åœ¨æŸäº›ç½‘ç«™æ— æ³•å·¥ä½œ
**è§£å†³æ–¹æ¡ˆ**:
```javascript
// æ£€æŸ¥æƒé™é…ç½®
chrome.permissions.getAll((permissions) => {
  console.log('Granted permissions:', permissions);
});

// è¯·æ±‚é¢å¤–æƒé™ï¼ˆå¦‚æœéœ€è¦ï¼‰
chrome.permissions.request({
  origins: ['https://specific-site.com/*']
});
```

### è°ƒè¯•å·¥å…·

#### 1. å¼€å‘è€…æ§åˆ¶å°å‘½ä»¤
```javascript
// å¯ç”¨è¯¦ç»†æ—¥å¿—
window.wxtDebug = true;

// æŸ¥çœ‹æ‰©å±•çŠ¶æ€
window.wxtExtension.getStatus();

// å¼ºåˆ¶é‡æ–°å¤„ç†é¡µé¢
window.wxtExtension.reprocess();

// æ¸…é™¤æ‰€æœ‰ç¼“å­˜
window.wxtExtension.clearCache();
```

#### 2. æ€§èƒ½åˆ†æ
```javascript
// æµ‹é‡ç¿»è¯‘æ€§èƒ½
console.time('translation');
await textReplacer.replaceText(text);
console.timeEnd('translation');

// ç›‘æ§å†…å­˜ä½¿ç”¨
const memoryInfo = performance.memory;
console.log('Memory usage:', {
  used: Math.round(memoryInfo.usedJSHeapSize / 1024 / 1024) + 'MB',
  total: Math.round(memoryInfo.totalJSHeapSize / 1024 / 1024) + 'MB'
});
```

### é”™è¯¯æŠ¥å‘Š

å¦‚æœé‡åˆ°æ— æ³•è§£å†³çš„é—®é¢˜ï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š

1. **ç¯å¢ƒä¿¡æ¯**:
   - æµè§ˆå™¨ç‰ˆæœ¬å’Œæ“ä½œç³»ç»Ÿ
   - æ‰©å±•ç‰ˆæœ¬å·
   - å¤ç°é—®é¢˜çš„å…·ä½“ç½‘ç«™

2. **é”™è¯¯ä¿¡æ¯**:
   - æ§åˆ¶å°é”™è¯¯æ—¥å¿—
   - æ‰©å±•è®¾ç½®é…ç½®
   - å…·ä½“çš„å¤ç°æ­¥éª¤

3. **è°ƒè¯•ä¿¡æ¯**:
   ```javascript
   // è¿è¡Œæ­¤å‘½ä»¤è·å–è°ƒè¯•ä¿¡æ¯
   console.log(JSON.stringify({
     version: chrome.runtime.getManifest().version,
     settings: await browser.storage.sync.get(),
     permissions: await chrome.permissions.getAll(),
     url: window.location.href
   }, null, 2));
   ```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒä¸è´¡çŒ®

### è´¡çŒ®æŒ‡å—

æˆ‘ä»¬æ¬¢è¿å„ç§å½¢å¼çš„è´¡çŒ®ï¼è¯·æŸ¥çœ‹ä¸»é¡¹ç›®çš„ [README.md](../README.md) äº†è§£å¦‚ä½•å‚ä¸è´¡çŒ®ã€‚

### æŠ€æœ¯è®¨è®º

- **GitHub Issues**: æŠ¥å‘Šé”™è¯¯å’ŒåŠŸèƒ½è¯·æ±‚
- **Pull Requests**: ä»£ç è´¡çŒ®å’Œæ”¹è¿›
- **Discussions**: æŠ€æœ¯è®¨è®ºå’Œç»éªŒåˆ†äº«

### å¼€å‘è·¯çº¿å›¾

#### å·²å®Œæˆç‰¹æ€§ âœ…
- [x] æ™ºèƒ½è¯­è¨€æ£€æµ‹ï¼ˆAIè‡ªåŠ¨è¯†åˆ«æºè¯­è¨€ï¼‰
- [x] æ™ºèƒ½å¤šè¯­è¨€æ¨¡å¼ï¼ˆ20+ç§è¯­è¨€æ”¯æŒï¼‰
- [x] å®Œæ•´å‘éŸ³å­¦ä¹ ç”Ÿæ€ç³»ç»Ÿï¼ˆéŸ³æ ‡+AIè¯ä¹‰+åŒTTSï¼‰
- [x] äº¤äº’å¼æ‚¬æµ®æ¡†ç³»ç»Ÿï¼ˆåŒå±‚å­¦ä¹ ä½“éªŒï¼‰
- [x] 7ç§ç¿»è¯‘æ ·å¼ï¼ˆå«å­¦ä¹ æ¨¡å¼ï¼‰
- [x] ä¸»é¢˜é€‚é…ç³»ç»Ÿï¼ˆæ·±è‰²/æµ…è‰²ï¼‰
- [x] æ™ºèƒ½ç¼“å­˜æœºåˆ¶ï¼ˆå¤šçº§ç¼“å­˜ä¼˜åŒ–ï¼‰

#### è§„åˆ’ä¸­ç‰¹æ€§ ğŸš€
- [ ] å¢åŠ å•è¯æ”¶è—å’Œå¤ä¹ åŠŸèƒ½
- [ ] å®ç°å­¦ä¹ è¿›åº¦è¿½è¸ª
- [ ] æ”¯æŒè‡ªå®šä¹‰è¯åº“å¯¼å…¥
- [ ] å¢åŠ è¯­æ³•åˆ†æå’Œå¥å‹å­¦ä¹ 
- [ ] å¼€å‘ç§»åŠ¨ç«¯ä¼´ä¾£åº”ç”¨
- [ ] æ”¯æŒæ›´å¤šTTSæœåŠ¡ï¼ˆAzureã€Googleç­‰ï¼‰

---
